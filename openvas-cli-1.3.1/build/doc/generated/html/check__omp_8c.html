<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenVAS CLI: nagios/check_omp.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_7031f86093ae5806d270c130bdfa84b8.html">nagios</a>
  </div>
</div>
<div class="contents">
<h1>check_omp.c File Reference</h1>
<p>The CHECK_OMP Nagios Command Plugin.  
<a href="#_details">More...</a></p>
<code>#include &lt;assert.h&gt;</code><br/>
<code>#include &lt;glib.h&gt;</code><br/>
<code>#include &lt;locale.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdarg.h&gt;</code><br/>
<code>#include &lt;openvas/misc/openvas_server.h&gt;</code><br/>
<code>#include &lt;openvas/misc/openvas_logging.h&gt;</code><br/>
<code>#include &lt;openvas/omp/omp.h&gt;</code><br/>
<div class="dynheader">
Include dependency graph for check_omp.c:</div>
<div class="dynsection">
</div>

<p><a href="check__omp_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structserver__connection__t.html">server_connection_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Information needed to handle a connection to a server.  <a href="structserver__connection__t.html#_details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="structcmd__status__opts__t.html">cmd_status_opts_t</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Options for status display.  <a href="structcmd__status__opts__t.html#_details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a369266c24eacffb87046522897a570d5">_GNU_SOURCE</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a461b1800181390fcfc1ab7df4f84e4fe">OMP_PROGNAME</a>&nbsp;&nbsp;&nbsp;&quot;check_omp&quot;</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">The name of this program.  <a href="#a461b1800181390fcfc1ab7df4f84e4fe"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#afa8b87beee6b1d2c4b16ca80b336de88">OPENVASMD_ADDRESS</a>&nbsp;&nbsp;&nbsp;&quot;127.0.0.1&quot;</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default Manager (openvasmd) address.  <a href="#afa8b87beee6b1d2c4b16ca80b336de88"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#ad97d19a93a8a4daec3b2fb200572e037">OPENVASMD_PORT</a>&nbsp;&nbsp;&nbsp;9390</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Default Manager port.  <a href="#ad97d19a93a8a4daec3b2fb200572e037"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a407d3f5171e51664312ce3656931a90b">DEFAULT_SOCKET_TIMEOUT</a>&nbsp;&nbsp;&nbsp;10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a5ecf26a9cf687c9d27ac06bce753e1d0">NAGIOS_OK</a>&nbsp;&nbsp;&nbsp;0</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#ac78db9b6e9b19e286399c14588972cbe">NAGIOS_WARNING</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>&nbsp;&nbsp;&nbsp;3</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a973b9c6490ded1130d983e3b05105ff3">NAGIOS_DEPENDENT</a>&nbsp;&nbsp;&nbsp;4</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a133170886ab3876880bba720829e4cea">STATUS_BY_TREND</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a9fd79bd1fe0cae20d8d644ff56a4fb18">STATUS_BY_LAST_REPORT</a>&nbsp;&nbsp;&nbsp;2</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="check__omp_8c.html#a3c04138a5bfe5d72780bb7e82a18e627">main</a> (int argc, char **argv)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>The CHECK_OMP Nagios Command Plugin. </p>
<p>This command line tool provides command line arguments corresponding to the OMP protocol commands for Nagios. </p>

<p>Definition in file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="a369266c24eacffb87046522897a570d5"></a><!-- doxytag: member="check_omp.c::_GNU_SOURCE" ref="a369266c24eacffb87046522897a570d5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _GNU_SOURCE</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00049">49</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a407d3f5171e51664312ce3656931a90b"></a><!-- doxytag: member="check_omp.c::DEFAULT_SOCKET_TIMEOUT" ref="a407d3f5171e51664312ce3656931a90b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DEFAULT_SOCKET_TIMEOUT&nbsp;&nbsp;&nbsp;10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00084">84</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a43af2d1e9ac5150e94f6e0d2819e3b4e"></a><!-- doxytag: member="check_omp.c::NAGIOS_CRITICAL" ref="a43af2d1e9ac5150e94f6e0d2819e3b4e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAGIOS_CRITICAL&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00098">98</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a973b9c6490ded1130d983e3b05105ff3"></a><!-- doxytag: member="check_omp.c::NAGIOS_DEPENDENT" ref="a973b9c6490ded1130d983e3b05105ff3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAGIOS_DEPENDENT&nbsp;&nbsp;&nbsp;4</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00108">108</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ecf26a9cf687c9d27ac06bce753e1d0"></a><!-- doxytag: member="check_omp.c::NAGIOS_OK" ref="a5ecf26a9cf687c9d27ac06bce753e1d0" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAGIOS_OK&nbsp;&nbsp;&nbsp;0</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00089">89</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac51e76ccbc3ff7ea0b9a9a878c0494ae"></a><!-- doxytag: member="check_omp.c::NAGIOS_UNKNOWN" ref="ac51e76ccbc3ff7ea0b9a9a878c0494ae" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAGIOS_UNKNOWN&nbsp;&nbsp;&nbsp;3</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00106">106</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<a class="anchor" id="ac78db9b6e9b19e286399c14588972cbe"></a><!-- doxytag: member="check_omp.c::NAGIOS_WARNING" ref="ac78db9b6e9b19e286399c14588972cbe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NAGIOS_WARNING&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00094">94</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a461b1800181390fcfc1ab7df4f84e4fe"></a><!-- doxytag: member="check_omp.c::OMP_PROGNAME" ref="a461b1800181390fcfc1ab7df4f84e4fe" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OMP_PROGNAME&nbsp;&nbsp;&nbsp;&quot;check_omp&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The name of this program. </p>

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00071">71</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="afa8b87beee6b1d2c4b16ca80b336de88"></a><!-- doxytag: member="check_omp.c::OPENVASMD_ADDRESS" ref="afa8b87beee6b1d2c4b16ca80b336de88" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPENVASMD_ADDRESS&nbsp;&nbsp;&nbsp;&quot;127.0.0.1&quot;</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default Manager (openvasmd) address. </p>

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00076">76</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad97d19a93a8a4daec3b2fb200572e037"></a><!-- doxytag: member="check_omp.c::OPENVASMD_PORT" ref="ad97d19a93a8a4daec3b2fb200572e037" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define OPENVASMD_PORT&nbsp;&nbsp;&nbsp;9390</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Default Manager port. </p>

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00081">81</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

</div>
</div>
<a class="anchor" id="a9fd79bd1fe0cae20d8d644ff56a4fb18"></a><!-- doxytag: member="check_omp.c::STATUS_BY_LAST_REPORT" ref="a9fd79bd1fe0cae20d8d644ff56a4fb18" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_BY_LAST_REPORT&nbsp;&nbsp;&nbsp;2</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00326">326</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a133170886ab3876880bba720829e4cea"></a><!-- doxytag: member="check_omp.c::STATUS_BY_TREND" ref="a133170886ab3876880bba720829e4cea" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define STATUS_BY_TREND&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00325">325</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>Referenced by <a class="el" href="check__omp_8c_source.html#l00909">main()</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a3c04138a5bfe5d72780bb7e82a18e627"></a><!-- doxytag: member="check_omp.c::main" ref="a3c04138a5bfe5d72780bb7e82a18e627" args="(int argc, char **argv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char **&nbsp;</td>
          <td class="paramname"> <em>argv</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000008">Todo:</a></b></dt><dd>Other modules ship with log level set to warning. </dd></dl>
</p>

<p>Definition at line <a class="el" href="check__omp_8c_source.html#l00909">909</a> of file <a class="el" href="check__omp_8c_source.html">check_omp.c</a>.</p>

<p>References <a class="el" href="check__omp_8c_source.html#l00139">cmd_status_opts_t::autofp</a>, <a class="el" href="check__omp_8c_source.html#l00084">DEFAULT_SOCKET_TIMEOUT</a>, <a class="el" href="check__omp_8c_source.html#l00135">cmd_status_opts_t::descr</a>, <a class="el" href="check__omp_8c_source.html#l00133">cmd_status_opts_t::dfn_ids</a>, <a class="el" href="omp_8c_source.html#l00110">server_connection_t::host_string</a>, <a class="el" href="check__omp_8c_source.html#l00137">cmd_status_opts_t::log_messages</a>, <a class="el" href="check__omp_8c_source.html#l00136">cmd_status_opts_t::manager_host</a>, <a class="el" href="check__omp_8c_source.html#l00098">NAGIOS_CRITICAL</a>, <a class="el" href="check__omp_8c_source.html#l00089">NAGIOS_OK</a>, <a class="el" href="check__omp_8c_source.html#l00106">NAGIOS_UNKNOWN</a>, <a class="el" href="check__omp_8c_source.html#l00134">cmd_status_opts_t::oids</a>, <a class="el" href="omp_8c_source.html#l00081">OPENVASMD_ADDRESS</a>, <a class="el" href="omp_8c_source.html#l00086">OPENVASMD_PORT</a>, <a class="el" href="omp_8c_source.html#l00109">server_connection_t::password</a>, <a class="el" href="omp_8c_source.html#l00112">server_connection_t::port</a>, <a class="el" href="check__omp_8c_source.html#l00132">cmd_status_opts_t::report_link</a>, <a class="el" href="check__omp_8c_source.html#l00138">cmd_status_opts_t::scan_end</a>, <a class="el" href="omp_8c_source.html#l00106">server_connection_t::session</a>, <a class="el" href="check__omp_8c_source.html#l00326">STATUS_BY_LAST_REPORT</a>, <a class="el" href="check__omp_8c_source.html#l00325">STATUS_BY_TREND</a>, <a class="el" href="omp_8c_source.html#l00114">server_connection_t::timeout</a>, and <a class="el" href="omp_8c_source.html#l00108">server_connection_t::username</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00910"></a>00910 {
<a name="l00911"></a>00911   <a class="code" href="structserver__connection__t.html" title="Information needed to handle a connection to a server.">server_connection_t</a> *connection = NULL;
<a name="l00912"></a>00912   <span class="comment">/* The return status of the command. */</span>
<a name="l00913"></a>00913   <span class="keywordtype">int</span> exit_status = -1;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915   <span class="comment">/* Global options. */</span>
<a name="l00916"></a>00916   <span class="keyword">static</span> gboolean print_version = FALSE;
<a name="l00917"></a>00917   <span class="keyword">static</span> gboolean be_verbose = FALSE;
<a name="l00918"></a>00918   <span class="keyword">static</span> gchar *manager_host_string = NULL;
<a name="l00919"></a>00919   <span class="keyword">static</span> gchar *manager_port_string = NULL;
<a name="l00920"></a>00920   <span class="keyword">static</span> gchar *manager_timeout_string = NULL;
<a name="l00921"></a>00921   <span class="keyword">static</span> gchar *omp_username = NULL;
<a name="l00922"></a>00922   <span class="keyword">static</span> gchar *omp_password = NULL;
<a name="l00923"></a>00923   <span class="comment">/* Command get-omp-version. */</span>
<a name="l00924"></a>00924   <span class="keyword">static</span> gboolean cmd_ping = FALSE;
<a name="l00925"></a>00925   <span class="keyword">static</span> gboolean cmd_status = FALSE;
<a name="l00926"></a>00926   <span class="keyword">static</span> gboolean status_trend = FALSE;
<a name="l00927"></a>00927   <span class="keyword">static</span> gboolean status_last_report = FALSE;
<a name="l00928"></a>00928   <span class="keyword">static</span> gchar *task_string = NULL;
<a name="l00929"></a>00929   <span class="keyword">static</span> gchar *host_filter = NULL;
<a name="l00930"></a>00930   <span class="keyword">static</span> gboolean connection_details = FALSE;
<a name="l00931"></a>00931   <span class="keyword">static</span> gboolean report_link = FALSE;
<a name="l00932"></a>00932   <span class="keyword">static</span> gboolean display_dfn_ids = FALSE;
<a name="l00933"></a>00933   <span class="keyword">static</span> gboolean display_oids = FALSE;
<a name="l00934"></a>00934   <span class="keyword">static</span> gboolean display_descriptions = FALSE;
<a name="l00935"></a>00935   <span class="keyword">static</span> gboolean display_log_messages = FALSE;
<a name="l00936"></a>00936   <span class="keyword">static</span> gboolean display_scan_end = FALSE;
<a name="l00937"></a>00937   <span class="keyword">static</span> guint autofp = 0;
<a name="l00938"></a>00938   <span class="comment">/* The rest of the args. */</span>
<a name="l00939"></a>00939   <span class="keyword">static</span> gchar **rest = NULL;
<a name="l00940"></a>00940 
<a name="l00941"></a>00941   GError *error = NULL;
<a name="l00942"></a>00942 
<a name="l00943"></a>00943   GOptionContext *option_context;
<a name="l00944"></a>00944   <span class="keyword">static</span> GOptionEntry option_entries[] = {
<a name="l00945"></a>00945     <span class="comment">/* Global options. */</span>
<a name="l00946"></a>00946     {<span class="stringliteral">&quot;host&quot;</span>, <span class="charliteral">&apos;H&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;manager_host_string,
<a name="l00947"></a>00947      <span class="stringliteral">&quot;Connect to manager on host &lt;host&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;host&gt;&quot;</span>},
<a name="l00948"></a>00948     {<span class="stringliteral">&quot;port&quot;</span>, <span class="charliteral">&apos;p&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;manager_port_string,
<a name="l00949"></a>00949      <span class="stringliteral">&quot;Use port number &lt;number&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;number&gt;&quot;</span>},
<a name="l00950"></a>00950     <span class="comment">// FIXME!!!</span>
<a name="l00951"></a>00951     {<span class="stringliteral">&quot;timeout&quot;</span>, <span class="charliteral">&apos;t&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;manager_timeout_string,
<a name="l00952"></a>00952      <span class="stringliteral">&quot;Use timeout &lt;number&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;number&gt;&quot;</span>},
<a name="l00953"></a>00953     {<span class="stringliteral">&quot;version&quot;</span>, <span class="charliteral">&apos;V&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;print_version,
<a name="l00954"></a>00954      <span class="stringliteral">&quot;Print version.&quot;</span>, NULL},
<a name="l00955"></a>00955     {<span class="stringliteral">&quot;verbose&quot;</span>, <span class="charliteral">&apos;v&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;be_verbose,
<a name="l00956"></a>00956      <span class="stringliteral">&quot;Verbose messages (WARNING: may reveal passwords).&quot;</span>, NULL},
<a name="l00957"></a>00957     {<span class="stringliteral">&quot;Werror&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;warnings_are_errors,
<a name="l00958"></a>00958      <span class="stringliteral">&quot;Turn status UNKNOWN into status CRITICIAL.&quot;</span>, NULL},
<a name="l00959"></a>00959     {<span class="stringliteral">&quot;username&quot;</span>, <span class="charliteral">&apos;u&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;omp_username,
<a name="l00960"></a>00960      <span class="stringliteral">&quot;OMP username&quot;</span>, <span class="stringliteral">&quot;&lt;username&gt;&quot;</span>},
<a name="l00961"></a>00961     {<span class="stringliteral">&quot;password&quot;</span>, <span class="charliteral">&apos;w&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;omp_password,
<a name="l00962"></a>00962      <span class="stringliteral">&quot;OMP password&quot;</span>, <span class="stringliteral">&quot;&lt;password&gt;&quot;</span>},
<a name="l00963"></a>00963     {<span class="stringliteral">&quot;ping&quot;</span>, <span class="charliteral">&apos;O&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;cmd_ping,
<a name="l00964"></a>00964      <span class="stringliteral">&quot;Ping the manager&quot;</span>, NULL},
<a name="l00965"></a>00965     {<span class="stringliteral">&quot;status&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;cmd_status,
<a name="l00966"></a>00966      <span class="stringliteral">&quot;Report status of task&quot;</span>, NULL},
<a name="l00967"></a>00967     {<span class="stringliteral">&quot;trend&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;status_trend,
<a name="l00968"></a>00968      <span class="stringliteral">&quot;Report status by trend (default)&quot;</span>, NULL},
<a name="l00969"></a>00969     {<span class="stringliteral">&quot;last-report&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;status_last_report,
<a name="l00970"></a>00970      <span class="stringliteral">&quot;Report status by last report&quot;</span>, NULL},
<a name="l00971"></a>00971     {<span class="stringliteral">&quot;task&quot;</span>, <span class="charliteral">&apos;T&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;task_string,
<a name="l00972"></a>00972      <span class="stringliteral">&quot;Report status of task &lt;task&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;task&gt;&quot;</span>},
<a name="l00973"></a>00973     {<span class="stringliteral">&quot;host-filter&quot;</span>, <span class="charliteral">&apos;F&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;host_filter,
<a name="l00974"></a>00974      <span class="stringliteral">&quot;Report last report status of host &lt;ip&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;ip&gt;&quot;</span>},
<a name="l00975"></a>00975     {<span class="stringliteral">&quot;overrides&quot;</span>, 0, 0, G_OPTION_ARG_INT, &amp;overrides_flag,
<a name="l00976"></a>00976      <span class="stringliteral">&quot;Include overrides (N: 0=no, 1=yes)&quot;</span>, <span class="stringliteral">&quot;N&quot;</span>},
<a name="l00977"></a>00977     {<span class="stringliteral">&quot;details&quot;</span>, <span class="charliteral">&apos;d&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;connection_details,
<a name="l00978"></a>00978      <span class="stringliteral">&quot;Include connection details in output&quot;</span>, NULL},
<a name="l00979"></a>00979     {<span class="stringliteral">&quot;report-link&quot;</span>, <span class="charliteral">&apos;l&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;report_link,
<a name="l00980"></a>00980      <span class="stringliteral">&quot;Include URL of report in output&quot;</span>, NULL},
<a name="l00981"></a>00981     {<span class="stringliteral">&quot;dfn&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;display_dfn_ids,
<a name="l00982"></a>00982      <span class="stringliteral">&quot;Include DFN-CERT IDs on vulnerabilities in output&quot;</span>, NULL},
<a name="l00983"></a>00983     {<span class="stringliteral">&quot;oid&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;display_oids,
<a name="l00984"></a>00984      <span class="stringliteral">&quot;Include OIDs of NVTs finding vulnerabilities in output&quot;</span>, NULL},
<a name="l00985"></a>00985     {<span class="stringliteral">&quot;descr&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;display_descriptions,
<a name="l00986"></a>00986      <span class="stringliteral">&quot;Include descriptions of NVTs finding vulnerabilities in output&quot;</span>, NULL},
<a name="l00987"></a>00987     {<span class="stringliteral">&quot;showlog&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;display_log_messages,
<a name="l00988"></a>00988      <span class="stringliteral">&quot;Include log messages in output&quot;</span>, NULL},
<a name="l00989"></a>00989     {<span class="stringliteral">&quot;scanend&quot;</span>, 0, 0, G_OPTION_ARG_NONE, &amp;display_scan_end,
<a name="l00990"></a>00990      <span class="stringliteral">&quot;Include timestamp of scan end in output&quot;</span>, NULL},
<a name="l00991"></a>00991     {<span class="stringliteral">&quot;autofp&quot;</span>, 0, 0, G_OPTION_ARG_INT, &amp;autofp,
<a name="l00992"></a>00992      <span class="stringliteral">&quot;Trust vendor security updates for automatic false positive filtering (0=No, 1=full match, 2=partial).&quot;</span>, <span class="stringliteral">&quot;&lt;n&gt;&quot;</span>},
<a name="l00993"></a>00993     {G_OPTION_REMAINING, 0, 0, G_OPTION_ARG_STRING_ARRAY, &amp;rest,
<a name="l00994"></a>00994      NULL, NULL},
<a name="l00995"></a>00995     {NULL}
<a name="l00996"></a>00996   };
<a name="l00997"></a>00997 
<a name="l00998"></a>00998   <span class="keywordflow">if</span> (setlocale (LC_ALL, <span class="stringliteral">&quot;&quot;</span>) == NULL)
<a name="l00999"></a>00999     {
<a name="l01000"></a>01000       respond (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>, <span class="stringliteral">&quot;Failed to setlocale\n\n&quot;</span>);
<a name="l01001"></a>01001       do_exit (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>);
<a name="l01002"></a>01002     }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004   option_context =
<a name="l01005"></a>01005     g_option_context_new (<span class="stringliteral">&quot;- OpenVAS OMP Command Line Interface&quot;</span>);
<a name="l01006"></a>01006   g_option_context_add_main_entries (option_context, option_entries, NULL);
<a name="l01007"></a>01007   <span class="keywordflow">if</span> (!g_option_context_parse (option_context, &amp;argc, &amp;argv, &amp;error))
<a name="l01008"></a>01008     {
<a name="l01009"></a>01009       printf (<span class="stringliteral">&quot;%s\n\n&quot;</span>, error-&gt;message);
<a name="l01010"></a>01010       do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01011"></a>01011     }
<a name="l01012"></a>01012   g_option_context_free (option_context);
<a name="l01013"></a>01013 
<a name="l01014"></a>01014   <span class="keywordflow">if</span> (print_version)
<a name="l01015"></a>01015     {
<a name="l01016"></a>01016       printf (<span class="stringliteral">&quot;Check-OMP Nagios Command Plugin %s\n&quot;</span>, OPENVASCLI_VERSION);
<a name="l01017"></a>01017       printf (<span class="stringliteral">&quot;Copyright (C) 2013 Greenbone Networks GmbH\n&quot;</span>);
<a name="l01018"></a>01018       printf (<span class="stringliteral">&quot;License GPLv2+: GNU GPL version 2 or later\n&quot;</span>);
<a name="l01019"></a>01019       printf
<a name="l01020"></a>01020         (<span class="stringliteral">&quot;This is free software: you are free to change and redistribute it.\n&quot;</span>
<a name="l01021"></a>01021          <span class="stringliteral">&quot;There is NO WARRANTY, to the extent permitted by law.\n\n&quot;</span>);
<a name="l01022"></a>01022       do_exit (EXIT_SUCCESS);
<a name="l01023"></a>01023     }
<a name="l01024"></a>01024 
<a name="l01025"></a>01025   <span class="comment">/* Check that one and at most one command option is present. */</span>
<a name="l01026"></a>01026   {
<a name="l01027"></a>01027     <span class="keywordtype">int</span> commands;
<a name="l01028"></a>01028     commands = (int) cmd_ping + (<span class="keywordtype">int</span>) cmd_status;
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (commands == 0)
<a name="l01030"></a>01030       {
<a name="l01031"></a>01031         respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>, <span class="stringliteral">&quot;One command option must be present.\n&quot;</span>);
<a name="l01032"></a>01032         do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01033"></a>01033       }
<a name="l01034"></a>01034     <span class="keywordflow">if</span> (commands &gt; 1)
<a name="l01035"></a>01035       {
<a name="l01036"></a>01036         respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>, <span class="stringliteral">&quot;Only one command option must be present.\n&quot;</span>);
<a name="l01037"></a>01037         do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01038"></a>01038       }
<a name="l01039"></a>01039   }
<a name="l01040"></a>01040 
<a name="l01041"></a>01041   <span class="comment">/* Set defaults.  */</span>
<a name="l01042"></a>01042   <span class="keywordflow">if</span> (!status_trend &amp;&amp; !status_last_report)
<a name="l01043"></a>01043     status_trend = TRUE;
<a name="l01044"></a>01044   <span class="keywordflow">if</span> (status_trend &amp;&amp; status_last_report)
<a name="l01045"></a>01045     {
<a name="l01046"></a>01046       respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>, <span class="stringliteral">&quot;--trend and --last-report are exclusive.\n&quot;</span>);
<a name="l01047"></a>01047       do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01048"></a>01048     }
<a name="l01049"></a>01049 
<a name="l01050"></a>01050 
<a name="l01051"></a>01051   <span class="comment">/* Setup the connection structure.  */</span>
<a name="l01052"></a>01052   connection = g_malloc0 (<span class="keyword">sizeof</span> (*connection));
<a name="l01053"></a>01053 
<a name="l01054"></a>01054   <span class="keywordflow">if</span> (manager_host_string != NULL)
<a name="l01055"></a>01055     connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a> = manager_host_string;
<a name="l01056"></a>01056   <span class="keywordflow">else</span>
<a name="l01057"></a>01057     connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a> = <a class="code" href="omp_8c.html#afa8b87beee6b1d2c4b16ca80b336de88" title="Default Manager (openvasmd) address.">OPENVASMD_ADDRESS</a>;
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   <span class="keywordflow">if</span> (manager_port_string != NULL)
<a name="l01060"></a>01060     connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a> = atoi (manager_port_string);
<a name="l01061"></a>01061   <span class="keywordflow">else</span>
<a name="l01062"></a>01062     connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a> = <a class="code" href="omp_8c.html#ad97d19a93a8a4daec3b2fb200572e037" title="Default Manager port.">OPENVASMD_PORT</a>;
<a name="l01063"></a>01063 
<a name="l01064"></a>01064   <span class="keywordflow">if</span> (connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a> &lt;= 0 || connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a> &gt;= 65536)
<a name="l01065"></a>01065     {
<a name="l01066"></a>01066       respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>,
<a name="l01067"></a>01067                <span class="stringliteral">&quot;Manager port must be a number between 0 and 65536.\n&quot;</span>);
<a name="l01068"></a>01068       do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01069"></a>01069     }
<a name="l01070"></a>01070 
<a name="l01071"></a>01071   <span class="keywordflow">if</span> (omp_username != NULL)
<a name="l01072"></a>01072     connection-&gt;<a class="code" href="structserver__connection__t.html#a61a7e80906ce19c0dc25a92059bd62a1" title="Username with which to connect.">username</a> = omp_username;
<a name="l01073"></a>01073   <span class="keywordflow">if</span> (omp_password != NULL)
<a name="l01074"></a>01074     connection-&gt;<a class="code" href="structserver__connection__t.html#a41ecba5db56134f2c181f74619e25f91" title="Password for user with which to connect.">password</a> = omp_password;
<a name="l01075"></a>01075 
<a name="l01076"></a>01076   <span class="keywordflow">if</span> (manager_timeout_string != NULL)
<a name="l01077"></a>01077     connection-&gt;<a class="code" href="structserver__connection__t.html#a6445de8db03f5f8f91f2b68969683bc9" title="Timeout of request.">timeout</a> = atoi (manager_timeout_string);
<a name="l01078"></a>01078   <span class="keywordflow">else</span>
<a name="l01079"></a>01079     connection-&gt;<a class="code" href="structserver__connection__t.html#a6445de8db03f5f8f91f2b68969683bc9" title="Timeout of request.">timeout</a> = <a class="code" href="check__omp_8c.html#a407d3f5171e51664312ce3656931a90b">DEFAULT_SOCKET_TIMEOUT</a>;
<a name="l01080"></a>01080 
<a name="l01081"></a>01081   <span class="keywordflow">if</span> (connection-&gt;<a class="code" href="structserver__connection__t.html#a6445de8db03f5f8f91f2b68969683bc9" title="Timeout of request.">timeout</a> &lt; 0)
<a name="l01082"></a>01082     {
<a name="l01083"></a>01083       respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>,
<a name="l01084"></a>01084                <span class="stringliteral">&quot;Request timeout must be a non-negative number.\n&quot;</span>);
<a name="l01085"></a>01085       do_exit (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>);
<a name="l01086"></a>01086     }
<a name="l01087"></a>01087 
<a name="l01088"></a>01088   <span class="keywordflow">if</span> (be_verbose)
<a name="l01089"></a>01089     {
<a name="l01091"></a>01091       fprintf (stderr, <span class="stringliteral">&quot;Will try to connect to host %s, port %d...\n&quot;</span>,
<a name="l01092"></a>01092                connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a>, connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a>);
<a name="l01093"></a>01093     }
<a name="l01094"></a>01094   <span class="keywordflow">else</span>
<a name="l01095"></a>01095     {
<a name="l01096"></a>01096 <span class="preprocessor">#ifndef _WIN32</span>
<a name="l01097"></a>01097 <span class="preprocessor"></span>      g_log_set_default_handler (openvas_log_silent, NULL);
<a name="l01098"></a>01098 <span class="preprocessor">#endif</span>
<a name="l01099"></a>01099 <span class="preprocessor"></span>    }
<a name="l01100"></a>01100 
<a name="l01101"></a>01101   <span class="comment">/* Run the single command. */</span>
<a name="l01102"></a>01102 
<a name="l01103"></a>01103   <span class="keywordflow">if</span> (cmd_ping)
<a name="l01104"></a>01104     {
<a name="l01105"></a>01105       <span class="keywordtype">int</span> res;
<a name="l01106"></a>01106       manager_open (connection);
<a name="l01107"></a>01107       <span class="comment">/* Returns 0 on success, 1 if manager closed connection, 2 on</span>
<a name="l01108"></a>01108 <span class="comment">         timeout, -1 on error */</span>
<a name="l01109"></a>01109       res = omp_ping (&amp;(connection-&gt;<a class="code" href="structserver__connection__t.html#aca291023ee7ec263d6e4e544ed0786d8" title="GnuTLS Session to use.">session</a>), connection-&gt;<a class="code" href="structserver__connection__t.html#a6445de8db03f5f8f91f2b68969683bc9" title="Timeout of request.">timeout</a>);
<a name="l01110"></a>01110       <span class="keywordflow">if</span> (res == 0)
<a name="l01111"></a>01111         {
<a name="l01112"></a>01112           exit_status = respond (<a class="code" href="check__omp_8c.html#a5ecf26a9cf687c9d27ac06bce753e1d0">NAGIOS_OK</a>, <span class="stringliteral">&quot;Alive and kicking!\n&quot;</span>);
<a name="l01113"></a>01113         }
<a name="l01114"></a>01114       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 1)
<a name="l01115"></a>01115         {
<a name="l01116"></a>01116           exit_status = respond (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>, <span class="stringliteral">&quot;Connection closed\n&quot;</span>);
<a name="l01117"></a>01117         }
<a name="l01118"></a>01118       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (res == 2)
<a name="l01119"></a>01119         {
<a name="l01120"></a>01120           exit_status = respond (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>, <span class="stringliteral">&quot;Connection timed out\n&quot;</span>);
<a name="l01121"></a>01121         }
<a name="l01122"></a>01122       <span class="keywordflow">else</span>
<a name="l01123"></a>01123         {
<a name="l01124"></a>01124           exit_status = respond (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>, <span class="stringliteral">&quot;Unknown error\n&quot;</span>);
<a name="l01125"></a>01125         }
<a name="l01126"></a>01126       manager_close (connection);
<a name="l01127"></a>01127     }
<a name="l01128"></a>01128   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cmd_status)
<a name="l01129"></a>01129     {
<a name="l01130"></a>01130       entity_t status;
<a name="l01131"></a>01131 
<a name="l01132"></a>01132       <span class="keywordflow">if</span> (task_string == NULL)
<a name="l01133"></a>01133         {
<a name="l01134"></a>01134           exit_status =
<a name="l01135"></a>01135             respond (<a class="code" href="check__omp_8c.html#ac51e76ccbc3ff7ea0b9a9a878c0494ae">NAGIOS_UNKNOWN</a>, <span class="stringliteral">&quot;Status request requires task name\n&quot;</span>);
<a name="l01136"></a>01136         }
<a name="l01137"></a>01137       <span class="keywordflow">else</span>
<a name="l01138"></a>01138         {
<a name="l01139"></a>01139           manager_open (connection);
<a name="l01140"></a>01140           omp_get_tasks_opts_t opts;
<a name="l01141"></a>01141           <a class="code" href="structcmd__status__opts__t.html" title="Options for status display.">cmd_status_opts_t</a> status_opts;
<a name="l01142"></a>01142 
<a name="l01143"></a>01143           opts = omp_get_tasks_opts_defaults;
<a name="l01144"></a>01144           opts.details = 1;
<a name="l01145"></a>01145           opts.filter = <span class="stringliteral">&quot;permission=any owner=any rows=-1&quot;</span>;
<a name="l01146"></a>01146 
<a name="l01147"></a>01147           <span class="keywordflow">if</span> (display_descriptions)
<a name="l01148"></a>01148             display_oids = TRUE;
<a name="l01149"></a>01149 
<a name="l01150"></a>01150           <span class="keywordflow">if</span> (display_dfn_ids)
<a name="l01151"></a>01151             display_oids = TRUE;
<a name="l01152"></a>01152 
<a name="l01153"></a>01153           status_opts.<a class="code" href="structcmd__status__opts__t.html#a7890f68aaddc8e7b9e8261d94e170b7b" title="TRUE if the report URL should be included.">report_link</a> = report_link;
<a name="l01154"></a>01154           status_opts.<a class="code" href="structcmd__status__opts__t.html#ab02c515e68c385870a326e2cc0b547cd" title="TRUE if DFN-CERT-IDs should be included.">dfn_ids</a> = display_dfn_ids;
<a name="l01155"></a>01155           status_opts.<a class="code" href="structcmd__status__opts__t.html#af5cf5649dcf90f418f625a9eb9b8336b" title="TRUE if NVT OIDs should be included.">oids</a> = display_oids;
<a name="l01156"></a>01156           status_opts.<a class="code" href="structcmd__status__opts__t.html#adc725d4630d48c20f3e6431bef2285dd" title="Pointer to name of the manager host for use in the report link.">manager_host</a> = (gpointer) connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a>;
<a name="l01157"></a>01157           status_opts.<a class="code" href="structcmd__status__opts__t.html#adc73f7a48f6de51c1bb759c0a212e5c7" title="TRUE if NVT descriptions should be included.">descr</a> = display_descriptions;
<a name="l01158"></a>01158           status_opts.<a class="code" href="structcmd__status__opts__t.html#a6c4e0a4e84d13cc2af2a3e28838afb7f" title="TRUE if log messages should be included.">log_messages</a> = display_log_messages;
<a name="l01159"></a>01159           status_opts.<a class="code" href="structcmd__status__opts__t.html#a4cf95a5a324381344f6a3cdf2fdc7935" title="TRUE if the time the scan finished should be included.">scan_end</a> = display_scan_end;
<a name="l01160"></a>01160           status_opts.<a class="code" href="structcmd__status__opts__t.html#aefa24ba0401fa68df50a1c5ee51ab89e" title="Whether to trust vendor security updates. 0 No, 1 full match, 2 partial.">autofp</a> = autofp;
<a name="l01161"></a>01161 
<a name="l01162"></a>01162           <span class="comment">/* Returns 0 on success, -1 or OMP code on error.  */</span>
<a name="l01163"></a>01163           if (omp_get_tasks_ext (&amp;(connection-&gt;<a class="code" href="structserver__connection__t.html#aca291023ee7ec263d6e4e544ed0786d8" title="GnuTLS Session to use.">session</a>), opts, &amp;status))
<a name="l01164"></a>01164             {
<a name="l01165"></a>01165               exit_status = respond (<a class="code" href="check__omp_8c.html#a43af2d1e9ac5150e94f6e0d2819e3b4e">NAGIOS_CRITICAL</a>, <span class="stringliteral">&quot;Get tasks failed\n&quot;</span>);
<a name="l01166"></a>01166             }
<a name="l01167"></a>01167           <span class="keywordflow">else</span>
<a name="l01168"></a>01168             {
<a name="l01169"></a>01169               exit_status =
<a name="l01170"></a>01170                 cmd_status_impl (connection, task_string, status-&gt;entities,
<a name="l01171"></a>01171                                  status_trend ? <a class="code" href="check__omp_8c.html#a133170886ab3876880bba720829e4cea">STATUS_BY_TREND</a> :
<a name="l01172"></a>01172                                  <a class="code" href="check__omp_8c.html#a9fd79bd1fe0cae20d8d644ff56a4fb18">STATUS_BY_LAST_REPORT</a>, host_filter,
<a name="l01173"></a>01173                                  status_opts);
<a name="l01174"></a>01174             }
<a name="l01175"></a>01175           manager_close (connection);
<a name="l01176"></a>01176         }
<a name="l01177"></a>01177     }
<a name="l01178"></a>01178   <span class="keywordflow">else</span>
<a name="l01179"></a>01179     <span class="comment">/* The option processing ensures that at least one command is present. */</span>
<a name="l01180"></a>01180     assert (0);
<a name="l01181"></a>01181 
<a name="l01182"></a>01182   <span class="comment">/* Exit. */</span>
<a name="l01183"></a>01183 
<a name="l01184"></a>01184   <span class="keywordflow">if</span> (connection_details)
<a name="l01185"></a>01185     {
<a name="l01186"></a>01186       <span class="keywordflow">if</span> (connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a>)
<a name="l01187"></a>01187         respond_data (<span class="stringliteral">&quot;GSM_Host: %s:%d\n&quot;</span>, connection-&gt;<a class="code" href="structserver__connection__t.html#ad5f6fa44ac42acaa8333b5dfd00b094c" title="Server host string.">host_string</a>,
<a name="l01188"></a>01188                       (<span class="keywordtype">int</span>) connection-&gt;<a class="code" href="structserver__connection__t.html#aa2137ea29992e3851af1cf5e3c7f3887" title="Port of server.">port</a>);
<a name="l01189"></a>01189       <span class="keywordflow">if</span> (connection-&gt;<a class="code" href="structserver__connection__t.html#a61a7e80906ce19c0dc25a92059bd62a1" title="Username with which to connect.">username</a>)
<a name="l01190"></a>01190         respond_data (<span class="stringliteral">&quot;OMP_User: %s\n&quot;</span>, connection-&gt;<a class="code" href="structserver__connection__t.html#a61a7e80906ce19c0dc25a92059bd62a1" title="Username with which to connect.">username</a>);
<a name="l01191"></a>01191       <span class="keywordflow">if</span> (task_string &amp;&amp; cmd_status)
<a name="l01192"></a>01192         respond_data (<span class="stringliteral">&quot;Task: %s\n&quot;</span>, task_string);
<a name="l01193"></a>01193     }
<a name="l01194"></a>01194 
<a name="l01195"></a>01195   <span class="keywordflow">if</span> (be_verbose)
<a name="l01196"></a>01196     {
<a name="l01197"></a>01197       <span class="keywordflow">if</span> (exit_status != <a class="code" href="check__omp_8c.html#a5ecf26a9cf687c9d27ac06bce753e1d0">NAGIOS_OK</a>)
<a name="l01198"></a>01198         respond_data (<span class="stringliteral">&quot;Command failed.\n&quot;</span>);
<a name="l01199"></a>01199       <span class="keywordflow">else</span>
<a name="l01200"></a>01200         respond_data (<span class="stringliteral">&quot;Command completed successfully.\n&quot;</span>);
<a name="l01201"></a>01201     }
<a name="l01202"></a>01202 
<a name="l01203"></a>01203   do_exit (exit_status);
<a name="l01204"></a>01204 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Oct 2015 for OpenVAS CLI by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
