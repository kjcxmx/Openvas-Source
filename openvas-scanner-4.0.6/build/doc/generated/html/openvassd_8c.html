<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenVAS Scanner: src/openvassd.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1c445093eb429e71cff849a5afa0a294.html">src</a>
  </div>
</div>
<div class="contents">
<h1>openvassd.c File Reference</h1><code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;arpa/inet.h&gt;</code><br/>
<code>#include &lt;signal.h&gt;</code><br/>
<code>#include &lt;netdb.h&gt;</code><br/>
<code>#include &lt;sys/wait.h&gt;</code><br/>
<code>#include &lt;openvas/nasl/nasl.h&gt;</code><br/>
<code>#include &lt;openvas/misc/network.h&gt;</code><br/>
<code>#include &lt;openvas/misc/plugutils.h&gt;</code><br/>
<code>#include &lt;openvas/misc/system.h&gt;</code><br/>
<code>#include &lt;openvas/misc/openvas_proctitle.h&gt;</code><br/>
<code>#include &lt;openvas/misc/openvas_logging.h&gt;</code><br/>
<code>#include &lt;openvas/base/pidfile.h&gt;</code><br/>
<code>#include &lt;openvas/base/nvticache.h&gt;</code><br/>
<code>#include &lt;gnutls/gnutls.h&gt;</code><br/>
<code>#include &lt;gnutls/x509.h&gt;</code><br/>
<code>#include &lt;glib.h&gt;</code><br/>
<code>#include &lt;gcrypt.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="pluginload_8h_source.html">pluginload.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="preferences_8h_source.html">preferences.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="comm_8h_source.html">comm.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="attack_8h_source.html">attack.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="sighand_8h_source.html">sighand.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="processes_8h_source.html">processes.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="ntp_8h_source.html">ntp.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="utils_8h_source.html">utils.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pluginscheduler_8h_source.html">pluginscheduler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pluginlaunch_8h_source.html">pluginlaunch.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for openvassd.c:</div>
<div class="dynsection">
</div>

<p><a href="openvassd_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#acb4efc7128acf41828229c8a39e64c80">loading_handler_stop</a> (pid_t handler_pid)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#a4aeebf358bcf8aecfc8aff0591c3efed">check_client</a> (char *dname)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#a0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">openvassd.  <a href="#a0ddf1224851353fc92bfbff6f499fa97"></a><br/></td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#aa9bb50111a16f5c9980292812ae00001">global_max_hosts</a> = 15</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#a8f455b2af441b4d35afa858eb16c0c1c">global_max_checks</a> = 10</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct arglist *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#a1616d1fe9c87a7e73981306c1015d403">g_options</a> = NULL</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#aa13a1fdb510c310431dcdd8754bcec98">global_iana_socket</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct arglist *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#ad81be98314339aa60f1227b0c1627ef5">global_plugins</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct arglist *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="openvassd_8c.html#aa809d323834a1bd34fcda06bbd00464b">global_preferences</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>OpenVAS Scanner main module, runs the scanner. </p>

<p>Definition in file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a4aeebf358bcf8aecfc8aff0591c3efed"></a><!-- doxytag: member="openvassd.c::check_client" ref="a4aeebf358bcf8aecfc8aff0591c3efed" args="(char *dname)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int check_client </td>
          <td>(</td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>dname</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00330">330</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>References <a class="el" href="log_8c_source.html#l00147">log_write()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00331"></a>00331 {
<a name="l00332"></a>00332   <span class="keywordtype">int</span> success = 0;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334   <span class="keywordflow">if</span> (dname != NULL &amp;&amp; *dname != <span class="charliteral">&apos;\0&apos;</span>)
<a name="l00335"></a>00335     {
<a name="l00336"></a>00336       FILE *f;
<a name="l00337"></a>00337       <span class="keywordflow">if</span> ((f = fopen (OPENVAS_STATE_DIR <span class="stringliteral">&quot;/dname&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>)) == NULL)
<a name="l00338"></a>00338         perror (OPENVAS_STATE_DIR <span class="stringliteral">&quot;/dname&quot;</span>);
<a name="l00339"></a>00339       <span class="keywordflow">else</span>
<a name="l00340"></a>00340         {
<a name="l00341"></a>00341           <span class="keywordtype">char</span> dnameref[512];
<a name="l00342"></a>00342 
<a name="l00343"></a>00343           <span class="keywordflow">while</span> (! success
<a name="l00344"></a>00344                  &amp;&amp; fgets (dnameref, <span class="keyword">sizeof</span> (dnameref) - 1, f) != NULL)
<a name="l00345"></a>00345             {
<a name="l00346"></a>00346               <span class="keywordtype">char</span> *p;
<a name="l00347"></a>00347               <span class="keywordflow">if</span> ((p = strchr (dnameref, <span class="charliteral">&apos;\n&apos;</span>)) != NULL)
<a name="l00348"></a>00348                 *p = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00349"></a>00349               <span class="keywordflow">if</span> (strcmp (dname, dnameref) == 0)
<a name="l00350"></a>00350                 success = 1;
<a name="l00351"></a>00351             }
<a name="l00352"></a>00352           <span class="keywordflow">if</span> (! success)
<a name="l00353"></a>00353             <a class="code" href="log_8c.html#aebd780cf62bc3eed16f852bd30250a3a">log_write</a>
<a name="l00354"></a>00354               (<span class="stringliteral">&quot;check_client: Bad DN\nGiven DN=%s\nLast tried DN=%s\n&quot;</span>,
<a name="l00355"></a>00355                dname, dnameref);
<a name="l00356"></a>00356           fclose (f);
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360   <span class="keywordflow">return</span> success;
<a name="l00361"></a>00361 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="acb4efc7128acf41828229c8a39e64c80"></a><!-- doxytag: member="openvassd.c::loading_handler_stop" ref="acb4efc7128acf41828229c8a39e64c80" args="(pid_t handler_pid)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void loading_handler_stop </td>
          <td>(</td>
          <td class="paramtype">pid_t&nbsp;</td>
          <td class="paramname"> <em>handler_pid</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00287">287</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>References <a class="el" href="pluginload_8c_source.html#l00163">destroy_loading_shm()</a>.</p>

<p>Referenced by <a class="el" href="openvassd_8c_source.html#l00755">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00288"></a>00288 {
<a name="l00289"></a>00289   <span class="keywordtype">int</span> status;
<a name="l00290"></a>00290 
<a name="l00291"></a>00291   kill (handler_pid, SIGTERM);
<a name="l00292"></a>00292   waitpid (handler_pid, &amp;status, 0);
<a name="l00293"></a>00293   <a class="code" href="pluginload_8c.html#a461f776ea45d557a09ba1a0b02e76452">destroy_loading_shm</a> ();
<a name="l00294"></a>00294 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="openvassd.c::main" ref="a0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>openvassd. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>argc</em>&nbsp;</td><td>Argument count. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>argv</em>&nbsp;</td><td>Argument vector. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00755">755</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>References <a class="el" href="openvassd_8c_source.html#l00087">g_options</a>, <a class="el" href="openvassd_8c_source.html#l00089">global_iana_socket</a>, <a class="el" href="openvassd_8c_source.html#l00090">global_plugins</a>, <a class="el" href="openvassd_8c_source.html#l00091">global_preferences</a>, and <a class="el" href="openvassd_8c_source.html#l00287">loading_handler_stop()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00756"></a>00756 {
<a name="l00757"></a>00757   <span class="keywordtype">int</span> exit_early = 0, scanner_port = 9391;
<a name="l00758"></a>00758   pid_t handler_pid;
<a name="l00759"></a>00759   <span class="keywordtype">char</span> *myself;
<a name="l00760"></a>00760   <span class="keyword">struct </span>arglist *options = emalloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> arglist));
<a name="l00761"></a>00761   <span class="keyword">struct </span>addrinfo *mysaddr;
<a name="l00762"></a>00762   <span class="keyword">struct </span>addrinfo hints;
<a name="l00763"></a>00763   <span class="keyword">struct </span>addrinfo ai;
<a name="l00764"></a>00764   <span class="keyword">struct </span>sockaddr_in saddr;
<a name="l00765"></a>00765   <span class="keyword">struct </span>sockaddr_in6 s6addr;
<a name="l00766"></a>00766 
<a name="l00767"></a>00767   proctitle_init (argc, argv);
<a name="l00768"></a>00768   gcrypt_init ();
<a name="l00769"></a>00769 
<a name="l00770"></a>00770   <span class="keywordflow">if</span> ((myself = strrchr (*argv, <span class="charliteral">&apos;/&apos;</span>)) == 0)
<a name="l00771"></a>00771     myself = *argv;
<a name="l00772"></a>00772   <span class="keywordflow">else</span>
<a name="l00773"></a>00773     myself++;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775   <span class="keyword">static</span> gboolean display_version = FALSE;
<a name="l00776"></a>00776   <span class="keyword">static</span> gboolean dont_fork = FALSE;
<a name="l00777"></a>00777   <span class="keyword">static</span> gchar *address = NULL;
<a name="l00778"></a>00778   <span class="keyword">static</span> gchar *port = NULL;
<a name="l00779"></a>00779   <span class="keyword">static</span> gchar *config_file = NULL;
<a name="l00780"></a>00780   <span class="keyword">static</span> gchar *gnutls_priorities = <span class="stringliteral">&quot;NORMAL&quot;</span>;
<a name="l00781"></a>00781   <span class="keyword">static</span> gchar *dh_params = NULL;
<a name="l00782"></a>00782   <span class="keyword">static</span> gboolean print_specs = FALSE;
<a name="l00783"></a>00783   <span class="keyword">static</span> gboolean print_sysconfdir = FALSE;
<a name="l00784"></a>00784   <span class="keyword">static</span> gboolean only_cache = FALSE;
<a name="l00785"></a>00785   GError *error = NULL;
<a name="l00786"></a>00786   GOptionContext *option_context;
<a name="l00787"></a>00787   <span class="keyword">static</span> GOptionEntry entries[] = {
<a name="l00788"></a>00788     {<span class="stringliteral">&quot;version&quot;</span>, <span class="charliteral">&apos;V&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;display_version,
<a name="l00789"></a>00789      <span class="stringliteral">&quot;Display version information&quot;</span>, NULL},
<a name="l00790"></a>00790     {<span class="stringliteral">&quot;foreground&quot;</span>, <span class="charliteral">&apos;f&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;dont_fork,
<a name="l00791"></a>00791      <span class="stringliteral">&quot;Do not run in daemon mode but stay in foreground&quot;</span>, NULL},
<a name="l00792"></a>00792     {<span class="stringliteral">&quot;listen&quot;</span>, <span class="charliteral">&apos;a&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;address,
<a name="l00793"></a>00793      <span class="stringliteral">&quot;Listen on &lt;address&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;address&gt;&quot;</span>},
<a name="l00794"></a>00794     {<span class="stringliteral">&quot;port&quot;</span>, <span class="charliteral">&apos;p&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;port,
<a name="l00795"></a>00795      <span class="stringliteral">&quot;Use port number &lt;number&gt;&quot;</span>, <span class="stringliteral">&quot;&lt;number&gt;&quot;</span>},
<a name="l00796"></a>00796     {<span class="stringliteral">&quot;config-file&quot;</span>, <span class="charliteral">&apos;c&apos;</span>, 0, G_OPTION_ARG_FILENAME, &amp;config_file,
<a name="l00797"></a>00797      <span class="stringliteral">&quot;Configuration file&quot;</span>, <span class="stringliteral">&quot;&lt;.rcfile&gt;&quot;</span>},
<a name="l00798"></a>00798     {<span class="stringliteral">&quot;cfg-specs&quot;</span>, <span class="charliteral">&apos;s&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;print_specs,
<a name="l00799"></a>00799      <span class="stringliteral">&quot;Print configuration settings&quot;</span>, NULL},
<a name="l00800"></a>00800     {<span class="stringliteral">&quot;sysconfdir&quot;</span>, <span class="charliteral">&apos;y&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;print_sysconfdir,
<a name="l00801"></a>00801      <span class="stringliteral">&quot;Print system configuration directory (set at compile time)&quot;</span>, NULL},
<a name="l00802"></a>00802     {<span class="stringliteral">&quot;only-cache&quot;</span>, <span class="charliteral">&apos;C&apos;</span>, 0, G_OPTION_ARG_NONE, &amp;only_cache,
<a name="l00803"></a>00803      <span class="stringliteral">&quot;Exit once the NVT cache has been initialized or updated&quot;</span>, NULL},
<a name="l00804"></a>00804     {<span class="stringliteral">&quot;gnutls-priorities&quot;</span>, <span class="charliteral">&apos;\0&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;gnutls_priorities,
<a name="l00805"></a>00805      <span class="stringliteral">&quot;GnuTLS priorities string&quot;</span>, <span class="stringliteral">&quot;&lt;string&gt;&quot;</span>},
<a name="l00806"></a>00806     {<span class="stringliteral">&quot;dh-params&quot;</span>, <span class="charliteral">&apos;\0&apos;</span>, 0, G_OPTION_ARG_STRING, &amp;dh_params,
<a name="l00807"></a>00807      <span class="stringliteral">&quot;Diffie-Hellman parameters file&quot;</span>, <span class="stringliteral">&quot;&lt;string&gt;&quot;</span>},
<a name="l00808"></a>00808     {NULL}
<a name="l00809"></a>00809   };
<a name="l00810"></a>00810 
<a name="l00811"></a>00811   option_context =
<a name="l00812"></a>00812     g_option_context_new (<span class="stringliteral">&quot;- Scanner of the Open Vulnerability Assessment System&quot;</span>);
<a name="l00813"></a>00813   g_option_context_add_main_entries (option_context, entries, NULL);
<a name="l00814"></a>00814   <span class="keywordflow">if</span> (!g_option_context_parse (option_context, &amp;argc, &amp;argv, &amp;error))
<a name="l00815"></a>00815     {
<a name="l00816"></a>00816       g_print (<span class="stringliteral">&quot;%s\n\n&quot;</span>, error-&gt;message);
<a name="l00817"></a>00817       exit (0);
<a name="l00818"></a>00818     }
<a name="l00819"></a>00819   g_option_context_free (option_context);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821   <span class="keywordflow">if</span> (print_sysconfdir)
<a name="l00822"></a>00822     {
<a name="l00823"></a>00823       g_print (<span class="stringliteral">&quot;%s\n&quot;</span>, SYSCONFDIR);
<a name="l00824"></a>00824       exit (0);
<a name="l00825"></a>00825     }
<a name="l00826"></a>00826 
<a name="l00827"></a>00827   <span class="comment">/* Switch to UTC so that OTP times are always in UTC. */</span>
<a name="l00828"></a>00828   <span class="keywordflow">if</span> (setenv (<span class="stringliteral">&quot;TZ&quot;</span>, <span class="stringliteral">&quot;utc 0&quot;</span>, 1) == -1)
<a name="l00829"></a>00829     {
<a name="l00830"></a>00830       g_print (<span class="stringliteral">&quot;%s\n\n&quot;</span>, strerror (errno));
<a name="l00831"></a>00831       exit (0);
<a name="l00832"></a>00832     }
<a name="l00833"></a>00833   tzset ();
<a name="l00834"></a>00834 
<a name="l00835"></a>00835   <span class="keywordflow">if</span> (print_specs)
<a name="l00836"></a>00836     exit_early = 2;           <span class="comment">/* no cipher initialization */</span>
<a name="l00837"></a>00837 
<a name="l00838"></a>00838   <span class="keywordflow">if</span> (address != NULL)
<a name="l00839"></a>00839     {
<a name="l00840"></a>00840       memset (&amp;hints, 0, <span class="keyword">sizeof</span> (hints));
<a name="l00841"></a>00841       hints.ai_socktype = SOCK_STREAM;
<a name="l00842"></a>00842       hints.ai_protocol = IPPROTO_TCP;
<a name="l00843"></a>00843       hints.ai_flags = AI_NUMERICHOST;
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (getaddrinfo (address, NULL, &amp;hints, &amp;mysaddr))
<a name="l00845"></a>00845         {
<a name="l00846"></a>00846           printf (<span class="stringliteral">&quot;Invalid IP address.\n&quot;</span>);
<a name="l00847"></a>00847           printf (<span class="stringliteral">&quot;Please use %s --help for more information.\n&quot;</span>, myself);
<a name="l00848"></a>00848           exit (0);
<a name="l00849"></a>00849         }
<a name="l00850"></a>00850       <span class="comment">/* deep copy */</span>
<a name="l00851"></a>00851       ai.ai_family = mysaddr-&gt;ai_family;
<a name="l00852"></a>00852       <span class="keywordflow">if</span> (ai.ai_family == AF_INET)
<a name="l00853"></a>00853         {
<a name="l00854"></a>00854           memcpy (&amp;saddr, mysaddr-&gt;ai_addr, mysaddr-&gt;ai_addrlen);
<a name="l00855"></a>00855           ai.ai_addr = (<span class="keyword">struct </span>sockaddr *) &amp;saddr;
<a name="l00856"></a>00856         }
<a name="l00857"></a>00857       <span class="keywordflow">else</span>
<a name="l00858"></a>00858         {
<a name="l00859"></a>00859           memcpy (&amp;s6addr, mysaddr-&gt;ai_addr, mysaddr-&gt;ai_addrlen);
<a name="l00860"></a>00860           ai.ai_addr = (<span class="keyword">struct </span>sockaddr *) &amp;s6addr;
<a name="l00861"></a>00861         }
<a name="l00862"></a>00862       ai.ai_family = mysaddr-&gt;ai_family;
<a name="l00863"></a>00863       ai.ai_protocol = mysaddr-&gt;ai_protocol;
<a name="l00864"></a>00864       ai.ai_socktype = mysaddr-&gt;ai_socktype;
<a name="l00865"></a>00865       ai.ai_addrlen = mysaddr-&gt;ai_addrlen;
<a name="l00866"></a>00866       freeaddrinfo (mysaddr);
<a name="l00867"></a>00867     }
<a name="l00868"></a>00868   <span class="keywordflow">else</span>
<a name="l00869"></a>00869     {
<a name="l00870"></a>00870       <span class="comment">/* Default to IPv4 */</span>
<a name="l00871"></a>00871       <span class="comment">/*Warning: Not filling all the fields */</span>
<a name="l00872"></a>00872       saddr.sin_addr.s_addr = INADDR_ANY;
<a name="l00873"></a>00873       saddr.sin_family = ai.ai_family = AF_INET;
<a name="l00874"></a>00874       ai.ai_addrlen = <span class="keyword">sizeof</span> (saddr);
<a name="l00875"></a>00875       ai.ai_addr = (<span class="keyword">struct </span>sockaddr *) &amp;saddr;
<a name="l00876"></a>00876     }
<a name="l00877"></a>00877 
<a name="l00878"></a>00878   <span class="keywordflow">if</span> (port != NULL)
<a name="l00879"></a>00879     {
<a name="l00880"></a>00880       scanner_port = atoi (port);
<a name="l00881"></a>00881       <span class="keywordflow">if</span> ((scanner_port &lt;= 0) || (scanner_port &gt;= 65536))
<a name="l00882"></a>00882         {
<a name="l00883"></a>00883           printf (<span class="stringliteral">&quot;Invalid port specification.\n&quot;</span>);
<a name="l00884"></a>00884           printf (<span class="stringliteral">&quot;Please use %s --help for more information.\n&quot;</span>, myself);
<a name="l00885"></a>00885           exit (1);
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887     }
<a name="l00888"></a>00888 
<a name="l00889"></a>00889   <span class="keywordflow">if</span> (display_version)
<a name="l00890"></a>00890     {
<a name="l00891"></a>00891       printf (<span class="stringliteral">&quot;OpenVAS Scanner %s\n&quot;</span>, OPENVASSD_VERSION);
<a name="l00892"></a>00892       printf
<a name="l00893"></a>00893         (<span class="stringliteral">&quot;Nessus origin: (C) 2004 Renaud Deraison &lt;deraison@nessus.org&gt;\n&quot;</span>);
<a name="l00894"></a>00894       printf
<a name="l00895"></a>00895         (<span class="stringliteral">&quot;Most new code since OpenVAS: (C) 2013 Greenbone Networks GmbH\n&quot;</span>);
<a name="l00896"></a>00896       printf (<span class="stringliteral">&quot;License GPLv2: GNU GPL version 2\n&quot;</span>);
<a name="l00897"></a>00897       printf
<a name="l00898"></a>00898         (<span class="stringliteral">&quot;This is free software: you are free to change and redistribute it.\n&quot;</span>
<a name="l00899"></a>00899          <span class="stringliteral">&quot;There is NO WARRANTY, to the extent permitted by law.\n\n&quot;</span>);
<a name="l00900"></a>00900       exit (0);
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902 
<a name="l00903"></a>00903   <span class="keywordflow">if</span> (config_file != NULL)
<a name="l00904"></a>00904     arg_add_value (options, <span class="stringliteral">&quot;acc_hint&quot;</span>, ARG_INT, <span class="keyword">sizeof</span> (<span class="keywordtype">int</span>), (<span class="keywordtype">void</span> *) 1);
<a name="l00905"></a>00905 
<a name="l00906"></a>00906   <span class="keywordflow">if</span> (!config_file)
<a name="l00907"></a>00907     {
<a name="l00908"></a>00908       config_file = emalloc (strlen (OPENVASSD_CONF) + 1);
<a name="l00909"></a>00909       strncpy (config_file, OPENVASSD_CONF, strlen (OPENVASSD_CONF));
<a name="l00910"></a>00910     }
<a name="l00911"></a>00911 
<a name="l00912"></a>00912   arg_add_value (options, <span class="stringliteral">&quot;scanner_port&quot;</span>, ARG_INT, <span class="keyword">sizeof</span> (gpointer),
<a name="l00913"></a>00913                  GSIZE_TO_POINTER (scanner_port));
<a name="l00914"></a>00914   arg_add_value (options, <span class="stringliteral">&quot;config_file&quot;</span>, ARG_STRING, strlen (config_file),
<a name="l00915"></a>00915                  config_file);
<a name="l00916"></a>00916   arg_add_value (options, <span class="stringliteral">&quot;addr&quot;</span>, ARG_PTR, -1, &amp;ai);
<a name="l00917"></a>00917 
<a name="l00918"></a>00918   <span class="keywordflow">if</span> (only_cache)
<a name="l00919"></a>00919     {
<a name="l00920"></a>00920       init_openvassd (options, 0, 1, dont_fork);
<a name="l00921"></a>00921       init_plugins (options);
<a name="l00922"></a>00922       exit (0);
<a name="l00923"></a>00923     }
<a name="l00924"></a>00924 
<a name="l00925"></a>00925   init_openvassd (options, 1, exit_early, dont_fork);
<a name="l00926"></a>00926   <a class="code" href="openvassd_8c.html#a1616d1fe9c87a7e73981306c1015d403">g_options</a> = options;
<a name="l00927"></a>00927   <a class="code" href="openvassd_8c.html#aa13a1fdb510c310431dcdd8754bcec98">global_iana_socket</a> = GPOINTER_TO_SIZE (arg_get_value (options, <span class="stringliteral">&quot;isck&quot;</span>));
<a name="l00928"></a>00928   <a class="code" href="openvassd_8c.html#ad81be98314339aa60f1227b0c1627ef5">global_plugins</a> = arg_get_value (options, <span class="stringliteral">&quot;plugins&quot;</span>);
<a name="l00929"></a>00929 
<a name="l00930"></a>00930   <span class="comment">/* special treatment */</span>
<a name="l00931"></a>00931   <span class="keywordflow">if</span> (print_specs)
<a name="l00932"></a>00932     dump_cfg_specs (<a class="code" href="openvassd_8c.html#aa809d323834a1bd34fcda06bbd00464b">global_preferences</a>);
<a name="l00933"></a>00933   <span class="keywordflow">if</span> (exit_early)
<a name="l00934"></a>00934     exit (0);
<a name="l00935"></a>00935 
<a name="l00936"></a>00936   init_ssl_ctx (gnutls_priorities, dh_params);
<a name="l00937"></a>00937   <span class="comment">// Daemon mode:</span>
<a name="l00938"></a>00938   <span class="keywordflow">if</span> (dont_fork == FALSE)
<a name="l00939"></a>00939     set_daemon_mode ();
<a name="l00940"></a>00940   pidfile_create (<span class="stringliteral">&quot;openvassd&quot;</span>);
<a name="l00941"></a>00941   handler_pid = loading_handler_start ();
<a name="l00942"></a>00942   init_plugins (options);
<a name="l00943"></a>00943   <a class="code" href="openvassd_8c.html#acb4efc7128acf41828229c8a39e64c80">loading_handler_stop</a> (handler_pid);
<a name="l00944"></a>00944   main_loop ();
<a name="l00945"></a>00945   exit (0);
<a name="l00946"></a>00946 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a1616d1fe9c87a7e73981306c1015d403"></a><!-- doxytag: member="openvassd.c::g_options" ref="a1616d1fe9c87a7e73981306c1015d403" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct arglist* <a class="el" href="openvassd_8c.html#a1616d1fe9c87a7e73981306c1015d403">g_options</a> = NULL</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00087">87</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="openvassd_8c_source.html#l00755">main()</a>.</p>

</div>
</div>
<a class="anchor" id="aa13a1fdb510c310431dcdd8754bcec98"></a><!-- doxytag: member="openvassd.c::global_iana_socket" ref="aa13a1fdb510c310431dcdd8754bcec98" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="openvassd_8c.html#aa13a1fdb510c310431dcdd8754bcec98">global_iana_socket</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00089">89</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="openvassd_8c_source.html#l00755">main()</a>.</p>

</div>
</div>
<a class="anchor" id="a8f455b2af441b4d35afa858eb16c0c1c"></a><!-- doxytag: member="openvassd.c::global_max_checks" ref="a8f455b2af441b4d35afa858eb16c0c1c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="utils_8c.html#a8f455b2af441b4d35afa858eb16c0c1c">global_max_checks</a> = 10</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00086">86</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="utils_8c_source.html#l00156">get_max_checks_number()</a>.</p>

</div>
</div>
<a class="anchor" id="aa9bb50111a16f5c9980292812ae00001"></a><!-- doxytag: member="openvassd.c::global_max_hosts" ref="aa9bb50111a16f5c9980292812ae00001" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="utils_8c.html#aa9bb50111a16f5c9980292812ae00001">global_max_hosts</a> = 15</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Globals that should not be touched (used in utils module). </p>

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00085">85</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="utils_8c_source.html#l00125">get_max_hosts_number()</a>.</p>

</div>
</div>
<a class="anchor" id="ad81be98314339aa60f1227b0c1627ef5"></a><!-- doxytag: member="openvassd.c::global_plugins" ref="ad81be98314339aa60f1227b0c1627ef5" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct arglist* <a class="el" href="openvassd_8c.html#ad81be98314339aa60f1227b0c1627ef5">global_plugins</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00090">90</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="openvassd_8c_source.html#l00755">main()</a>.</p>

</div>
</div>
<a class="anchor" id="aa809d323834a1bd34fcda06bbd00464b"></a><!-- doxytag: member="openvassd.c::global_preferences" ref="aa809d323834a1bd34fcda06bbd00464b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct arglist* <a class="el" href="openvassd_8c.html#aa809d323834a1bd34fcda06bbd00464b">global_preferences</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="openvassd_8c_source.html#l00091">91</a> of file <a class="el" href="openvassd_8c_source.html">openvassd.c</a>.</p>

<p>Referenced by <a class="el" href="openvassd_8c_source.html#l00755">main()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Oct 2015 for OpenVAS Scanner by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
