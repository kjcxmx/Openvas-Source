<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenVAS Scanner: src/pluginscheduler.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1c445093eb429e71cff849a5afa0a294.html">src</a>
  </div>
</div>
<div class="contents">
<h1>pluginscheduler.c File Reference</h1><code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;openvas/base/nvti.h&gt;</code><br/>
<code>#include &lt;openvas/misc/nvt_categories.h&gt;</code><br/>
<code>#include &lt;openvas/misc/plugutils.h&gt;</code><br/>
<code>#include &lt;openvas/misc/system.h&gt;</code><br/>
<code>#include &lt;openvas/misc/arglists.h&gt;</code><br/>
<code>#include &lt;openvas/base/nvticache.h&gt;</code><br/>
<code>#include &lt;glib.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="pluginscheduler_8h_source.html">pluginscheduler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pluginload_8h_source.html">pluginload.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="pluginlaunch_8h_source.html">pluginlaunch.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="preferences_8h_source.html">preferences.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="log_8h_source.html">log.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for pluginscheduler.c:</div>
<div class="dynsection">
</div>

<p><a href="pluginscheduler_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#afe5e3dc345ecd161a2a82d46add5d9f4">IN_SCHEDULER_CODE</a>&nbsp;&nbsp;&nbsp;1</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#aab1b90f59dc5a2902b083c30abd7ff36">HASH_MAX</a>&nbsp;&nbsp;&nbsp;2713</td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a1327a8b5ad2cf52ed74f69b0c2ad35da">plugin_get_running_state</a> (struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin, int state)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structplist.html">plist</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a21138b699c77f747b0e13612914709b5">pl_get</a> (struct <a class="el" href="structplist.html">plist</a> *<a class="el" href="structlist.html">list</a>, char *name)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a7052f46503eccd2e8c61edeb9a6f738e">scheduler_mark_running_ports</a> (<a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> sched, struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a3b2be4a743db575b34c6bcc8d6ea4a12">scheduler_rm_running_ports</a> (<a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> sched, struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#ab8f94ad31e3c0272e1b035cedf241c9c">plugin_next_unrun_dependencie</a> (<a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> sched, struct <a class="el" href="structhash.html">hash</a> **dependencies_ptr)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a8e1b9ab914996adb316670f3df838604">plugins_scheduler_init</a> (struct arglist *plugins, int autoload, int only_network)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#acf304047d9f645137e28741395add3f9">plugins_scheduler_next</a> (<a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> h)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a643c6e4de6363b980f3642d41a19fe78">list_destroy</a> (struct <a class="el" href="structlist.html">list</a> *<a class="el" href="structlist.html">list</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="pluginscheduler_8c.html#a7b0040d82a6963686b920e1932cf7209">plugins_scheduler_free</a> (<a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> sched)</td></tr>
</table>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="aab1b90f59dc5a2902b083c30abd7ff36"></a><!-- doxytag: member="pluginscheduler.c::HASH_MAX" ref="aab1b90f59dc5a2902b083c30abd7ff36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define HASH_MAX&nbsp;&nbsp;&nbsp;2713</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000004">Todo:</a></b></dt><dd>The pluginscheduler uses a name cache for NVTs, depedencies and ports, as they are referenced by strings (names or OIDs). To remove duplicate code, the pluginscheduler was changed to share the name cache with the arglists. But the cache of the arglist is much smaller. It should be evaluated whether this influenced the performance (memory imprint should be smaller), and whether the string references could not be replaced e.g. by pointers to NVTi structs. </dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000005">Todo:</a></b></dt><dd>This important module needs documentation and comments. </dd></dl>

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00067">67</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00502">plugins_scheduler_init()</a>.</p>

</div>
</div>
<a class="anchor" id="afe5e3dc345ecd161a2a82d46add5d9f4"></a><!-- doxytag: member="pluginscheduler.c::IN_SCHEDULER_CODE" ref="afe5e3dc345ecd161a2a82d46add5d9f4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define IN_SCHEDULER_CODE&nbsp;&nbsp;&nbsp;1</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00044">44</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a643c6e4de6363b980f3642d41a19fe78"></a><!-- doxytag: member="pluginscheduler.c::list_destroy" ref="a643c6e4de6363b980f3642d41a19fe78" args="(struct list *list)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void list_destroy </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structlist.html">list</a> *&nbsp;</td>
          <td class="paramname"> <em>list</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00761">761</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00081">list::next</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00773">plugins_scheduler_free()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00762"></a>00762 {
<a name="l00763"></a>00763   <span class="keywordflow">while</span> (list != NULL)
<a name="l00764"></a>00764     {
<a name="l00765"></a>00765       <span class="keyword">struct </span>list *<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> = list-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00766"></a>00766       efree (&amp;list);
<a name="l00767"></a>00767       list = next;
<a name="l00768"></a>00768     }
<a name="l00769"></a>00769 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a21138b699c77f747b0e13612914709b5"></a><!-- doxytag: member="pluginscheduler.c::pl_get" ref="a21138b699c77f747b0e13612914709b5" args="(struct plist *list, char *name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structplist.html">plist</a>* pl_get </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structplist.html">plist</a> *&nbsp;</td>
          <td class="paramname"> <em>list</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>name</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00309">309</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00087">plist::name</a>, and <a class="el" href="pluginscheduler_8h_source.html#l00089">plist::next</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00331">scheduler_mark_running_ports()</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00361">scheduler_rm_running_ports()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00310"></a>00310 {
<a name="l00311"></a>00311   <span class="keywordflow">while</span> (list != NULL)
<a name="l00312"></a>00312     {
<a name="l00313"></a>00313       <span class="keywordflow">if</span> (strcmp (list-&gt;<a class="code" href="structplist.html#ad8d52ccb86142d47a88d314921d299e7">name</a>, <a class="code" href="structlist.html#ae50ae628ef9cb3e3eaa2a2ab9a045e8b">name</a>) == 0)
<a name="l00314"></a>00314         <span class="keywordflow">return</span> list;
<a name="l00315"></a>00315       <span class="keywordflow">else</span>
<a name="l00316"></a>00316         list = list-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a>;
<a name="l00317"></a>00317     }
<a name="l00318"></a>00318   <span class="keywordflow">return</span> NULL;
<a name="l00319"></a>00319 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a1327a8b5ad2cf52ed74f69b0c2ad35da"></a><!-- doxytag: member="pluginscheduler.c::plugin_get_running_state" ref="a1327a8b5ad2cf52ed74f69b0c2ad35da" args="(struct scheduler_plugin *plugin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int plugin_get_running_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00073">73</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00044">scheduler_plugin::running_state</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00400">plugin_next_unrun_dependencie()</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00629">plugins_scheduler_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00074"></a>00074 {
<a name="l00075"></a>00075   <span class="keywordflow">return</span> plugin-&gt;<a class="code" href="structscheduler__plugin.html#ada0afb1fdf8a2e681ff7568225fe803b">running_state</a>;
<a name="l00076"></a>00076 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="ab8f94ad31e3c0272e1b035cedf241c9c"></a><!-- doxytag: member="pluginscheduler.c::plugin_next_unrun_dependencie" ref="ab8f94ad31e3c0272e1b035cedf241c9c" args="(plugins_scheduler_t sched, struct hash **dependencies_ptr)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a>* plugin_next_unrun_dependencie </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structhash.html">hash</a> **&nbsp;</td>
          <td class="paramname"> <em>dependencies_ptr</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00400">400</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00072">hash::dependencies_ptr</a>, <a class="el" href="pluginscheduler_8h_source.html#l00105">PLUG_RUNNING</a>, <a class="el" href="pluginscheduler_8h_source.html#l00069">hash::plugin</a>, <a class="el" href="pluginscheduler_8c_source.html#l00073">plugin_get_running_state()</a>, <a class="el" href="pluginscheduler_8c_source.html#l00079">plugin_set_running_state()</a>, <a class="el" href="pluginscheduler_8h_source.html#l00108">PLUGIN_STATUS_DONE</a>, <a class="el" href="pluginscheduler_8h_source.html#l00109">PLUGIN_STATUS_DONE_AND_CLEANED</a>, <a class="el" href="pluginscheduler_8h_source.html#l00107">PLUGIN_STATUS_RUNNING</a>, <a class="el" href="pluginscheduler_8h_source.html#l00106">PLUGIN_STATUS_UNRUN</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00361">scheduler_rm_running_ports()</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00629">plugins_scheduler_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00402"></a>00402 {
<a name="l00403"></a>00403   <span class="keywordtype">int</span> flag = 0;
<a name="l00404"></a>00404   <span class="keywordtype">int</span> i;
<a name="l00405"></a>00405 
<a name="l00406"></a>00406   <span class="keywordflow">if</span> (dependencies_ptr == NULL)
<a name="l00407"></a>00407     <span class="keywordflow">return</span> NULL;
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="keywordflow">for</span> (i = 0; dependencies_ptr[i] != NULL; i++)
<a name="l00410"></a>00410     {
<a name="l00411"></a>00411       <span class="keyword">struct </span><a class="code" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin;
<a name="l00412"></a>00412       <span class="keywordtype">int</span> state;
<a name="l00413"></a>00413 
<a name="l00414"></a>00414       plugin = dependencies_ptr[i]-&gt;<a class="code" href="structhash.html#a17afc77d6adbaadc938853b753b05508">plugin</a>;
<a name="l00415"></a>00415       <span class="keywordflow">if</span> (plugin == NULL)
<a name="l00416"></a>00416         <span class="keywordflow">continue</span>;
<a name="l00417"></a>00417 
<a name="l00418"></a>00418       state = <a class="code" href="pluginscheduler_8c.html#a1327a8b5ad2cf52ed74f69b0c2ad35da">plugin_get_running_state</a> (plugin);
<a name="l00419"></a>00419       <span class="keywordflow">switch</span> (state)
<a name="l00420"></a>00420         {
<a name="l00421"></a>00421         <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#aca736cb6b0319a12bbc4c668d6422eee">PLUGIN_STATUS_UNRUN</a>:
<a name="l00422"></a>00422           {
<a name="l00423"></a>00423             <span class="keyword">struct </span><a class="code" href="structhash.html">hash</a> **deps_ptr;
<a name="l00424"></a>00424             <span class="keyword">struct </span><a class="code" href="structscheduler__plugin.html">scheduler_plugin</a> *ret;
<a name="l00425"></a>00425 
<a name="l00426"></a>00426             deps_ptr = dependencies_ptr[i]-&gt;<a class="code" href="structhash.html#a91510ec77e4855486dd6b5002df984b6">dependencies_ptr</a>;
<a name="l00427"></a>00427             <span class="keywordflow">if</span> (deps_ptr == NULL)
<a name="l00428"></a>00428               <span class="keywordflow">return</span> plugin;
<a name="l00429"></a>00429 
<a name="l00430"></a>00430             ret = <a class="code" href="pluginscheduler_8c.html#ab8f94ad31e3c0272e1b035cedf241c9c">plugin_next_unrun_dependencie</a> (sched, deps_ptr);
<a name="l00431"></a>00431             <span class="keywordflow">if</span> (ret == NULL)
<a name="l00432"></a>00432               <span class="keywordflow">return</span> plugin;
<a name="l00433"></a>00433 
<a name="l00434"></a>00434             <span class="keywordflow">if</span> (ret == <a class="code" href="pluginscheduler_8h.html#acecedc546dd6874231d0a3a7b8b2efc1">PLUG_RUNNING</a>)
<a name="l00435"></a>00435               flag = 1;
<a name="l00436"></a>00436             <span class="keywordflow">else</span>
<a name="l00437"></a>00437               <span class="keywordflow">return</span> ret;
<a name="l00438"></a>00438           }
<a name="l00439"></a>00439           <span class="keywordflow">break</span>;
<a name="l00440"></a>00440         <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#a38c038dee89b59d1c35b89fa1975d1b8">PLUGIN_STATUS_RUNNING</a>:
<a name="l00441"></a>00441           flag = 1;
<a name="l00442"></a>00442           <span class="keywordflow">break</span>;
<a name="l00443"></a>00443         <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#aaeac17a54597641bba55b1cc58d0d512">PLUGIN_STATUS_DONE</a>:
<a name="l00444"></a>00444           <a class="code" href="pluginscheduler_8c.html#a3b2be4a743db575b34c6bcc8d6ea4a12">scheduler_rm_running_ports</a> (sched, plugin);
<a name="l00445"></a>00445           <a class="code" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (plugin,
<a name="l00446"></a>00446                                     <a class="code" href="pluginscheduler_8h.html#a80c6adef8193e7aff1ea19b90cf0b0d9">PLUGIN_STATUS_DONE_AND_CLEANED</a>);
<a name="l00447"></a>00447           <span class="keywordflow">break</span>;
<a name="l00448"></a>00448         <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#a80c6adef8193e7aff1ea19b90cf0b0d9">PLUGIN_STATUS_DONE_AND_CLEANED</a>:
<a name="l00449"></a>00449           <span class="keywordflow">break</span>;
<a name="l00450"></a>00450         }
<a name="l00451"></a>00451     }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453   <span class="keywordflow">if</span> (!flag)
<a name="l00454"></a>00454     <span class="keywordflow">return</span> NULL;
<a name="l00455"></a>00455 
<a name="l00456"></a>00456   <span class="keywordflow">return</span> <a class="code" href="pluginscheduler_8h.html#acecedc546dd6874231d0a3a7b8b2efc1">PLUG_RUNNING</a>;
<a name="l00457"></a>00457 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a0009aa6c7d451e7c50fd5589dcc5a998"></a><!-- doxytag: member="pluginscheduler.c::plugin_set_running_state" ref="a0009aa6c7d451e7c50fd5589dcc5a998" args="(struct scheduler_plugin *plugin, int state)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void plugin_set_running_state </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>state</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00079">79</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00044">scheduler_plugin::running_state</a>.</p>

<p>Referenced by <a class="el" href="pluginlaunch_8c_source.html#l00473">plugin_launch()</a>, <a class="el" href="pluginscheduler_8c_source.html#l00400">plugin_next_unrun_dependencie()</a>, <a class="el" href="pluginlaunch_8c_source.html#l00441">pluginlaunch_stop()</a>, <a class="el" href="pluginscheduler_8c_source.html#l00629">plugins_scheduler_next()</a>, and <a class="el" href="pluginlaunch_8c_source.html#l00167">process_mgr_sighand_term()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00080"></a>00080 {
<a name="l00081"></a>00081   <span class="keywordflow">if</span> (plugin == NULL)
<a name="l00082"></a>00082     <span class="keywordflow">return</span>;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084   plugin-&gt;<a class="code" href="structscheduler__plugin.html#ada0afb1fdf8a2e681ff7568225fe803b">running_state</a> = state;
<a name="l00085"></a>00085 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a7b0040d82a6963686b920e1932cf7209"></a><!-- doxytag: member="pluginscheduler.c::plugins_scheduler_free" ref="a7b0040d82a6963686b920e1932cf7209" args="(plugins_scheduler_t sched)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void plugins_scheduler_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td>
          <td class="paramname"> <em>sched</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00773">773</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00095">plugins_scheduler_struct::hash</a>, <a class="el" href="pluginscheduler_8h_source.html#l00096">plugins_scheduler_struct::list</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00761">list_destroy()</a>.</p>

<p>Referenced by <a class="el" href="attack_8c_source.html#l01145">attack_network()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00774"></a>00774 {
<a name="l00775"></a>00775   <span class="keywordtype">int</span> i;
<a name="l00776"></a>00776   hash_destroy (sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a41c25c435ba066ae4943940c61cbdba3">hash</a>);
<a name="l00777"></a>00777   <span class="keywordflow">for</span> (i = ACT_FIRST; i &lt; ACT_LAST; i++)
<a name="l00778"></a>00778     <a class="code" href="pluginscheduler_8c.html#a643c6e4de6363b980f3642d41a19fe78">list_destroy</a> (sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[i]);
<a name="l00779"></a>00779   efree (&amp;sched);
<a name="l00780"></a>00780 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a8e1b9ab914996adb316670f3df838604"></a><!-- doxytag: member="pluginscheduler.c::plugins_scheduler_init" ref="a8e1b9ab914996adb316670f3df838604" args="(struct arglist *plugins, int autoload, int only_network)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> plugins_scheduler_init </td>
          <td>(</td>
          <td class="paramtype">struct arglist *&nbsp;</td>
          <td class="paramname"> <em>plugins</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>autoload</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>only_network</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p><dl class="todo"><dt><b><a class="el" href="todo.html#_todo000006">Todo:</a></b></dt><dd>: Valgrind reports a possible memleak in the str2arglist usage. </dd></dl>
</p>

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00502">502</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00052">scheduler_plugin::arglist</a>, <a class="el" href="pluginscheduler_8h_source.html#l00045">scheduler_plugin::category</a>, <a class="el" href="pluginscheduler_8h_source.html#l00051">scheduler_plugin::excluded_keys</a>, <a class="el" href="pluginscheduler_8h_source.html#l00095">plugins_scheduler_struct::hash</a>, <a class="el" href="pluginscheduler_8c_source.html#l00067">HASH_MAX</a>, <a class="el" href="pluginscheduler_8h_source.html#l00039">LAUNCH_DISABLED</a>, <a class="el" href="pluginscheduler_8h_source.html#l00096">plugins_scheduler_struct::list</a>, <a class="el" href="pluginscheduler_8h_source.html#l00050">scheduler_plugin::mandatory_keys</a>, <a class="el" href="pluginscheduler_8h_source.html#l00068">hash::name</a>, <a class="el" href="pluginscheduler_8h_source.html#l00079">list::name</a>, <a class="el" href="pluginscheduler_8h_source.html#l00074">hash::next</a>, <a class="el" href="pluginscheduler_8h_source.html#l00081">list::next</a>, <a class="el" href="pluginscheduler_8h_source.html#l00080">list::plugin</a>, <a class="el" href="pluginscheduler_8h_source.html#l00106">PLUGIN_STATUS_UNRUN</a>, <a class="el" href="pluginscheduler_8h_source.html#l00082">list::prev</a>, <a class="el" href="pluginscheduler_8h_source.html#l00049">scheduler_plugin::required_keys</a>, <a class="el" href="pluginscheduler_8h_source.html#l00047">scheduler_plugin::required_ports</a>, <a class="el" href="pluginscheduler_8h_source.html#l00048">scheduler_plugin::required_udp_ports</a>, <a class="el" href="pluginscheduler_8h_source.html#l00044">scheduler_plugin::running_state</a>, and <a class="el" href="pluginscheduler_8h_source.html#l00046">scheduler_plugin::timeout</a>.</p>

<p>Referenced by <a class="el" href="attack_8c_source.html#l01145">attack_network()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00504"></a>00504 {
<a name="l00505"></a>00505   <a class="code" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a> ret = emalloc (<span class="keyword">sizeof</span> (*ret));
<a name="l00506"></a>00506   <span class="keyword">struct </span>arglist *arg;
<a name="l00507"></a>00507   <span class="keywordtype">int</span> i;
<a name="l00508"></a>00508   <span class="keyword">struct </span><a class="code" href="structhash.html">hash</a> *l;
<a name="l00509"></a>00509 
<a name="l00510"></a>00510   <span class="keywordflow">if</span> (plugins == NULL)
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512       efree (ret);
<a name="l00513"></a>00513       <span class="keywordflow">return</span> NULL;
<a name="l00514"></a>00514     }
<a name="l00515"></a>00515 
<a name="l00516"></a>00516   <span class="comment">/* Fill our lists */</span>
<a name="l00517"></a>00517   ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a41c25c435ba066ae4943940c61cbdba3">hash</a> = hash_init ();
<a name="l00518"></a>00518   arg = plugins;
<a name="l00519"></a>00519   <span class="keywordflow">while</span> (arg-&gt;next != NULL)
<a name="l00520"></a>00520     {
<a name="l00521"></a>00521       <span class="keyword">struct </span><a class="code" href="structscheduler__plugin.html">scheduler_plugin</a> *<a class="code" href="structscheduler__plugin.html">scheduler_plugin</a>;
<a name="l00522"></a>00522       <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *dup;
<a name="l00523"></a>00523       <span class="keywordtype">char</span> *oid = (<span class="keywordtype">char</span> *)arg_get_value (arg-&gt;value, <span class="stringliteral">&quot;OID&quot;</span>);
<a name="l00524"></a>00524       <span class="keywordflow">if</span> (! oid) <span class="keywordflow">continue</span>; <span class="comment">// This would be a serious problem as it shouldn&apos;t be</span>
<a name="l00525"></a>00525       nvticache_t *nvticache = (nvticache_t *)arg_get_value (
<a name="l00526"></a>00526         arg_get_value (arg-&gt;value, <span class="stringliteral">&quot;preferences&quot;</span>), <span class="stringliteral">&quot;nvticache&quot;</span>);
<a name="l00527"></a>00527       nvti_t *nvti = (oid == NULL ? NULL : nvticache_get_by_oid (nvticache, oid));
<a name="l00528"></a>00528       <span class="keywordtype">int</span> category = nvti_category (nvti);
<a name="l00529"></a>00529 
<a name="l00530"></a>00530       scheduler_plugin = emalloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> scheduler_plugin));
<a name="l00531"></a>00531       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a59c91d46136c4a0d21c0f7937515dfff">arglist</a> = arg;
<a name="l00532"></a>00532       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#ada0afb1fdf8a2e681ff7568225fe803b">running_state</a> = <a class="code" href="pluginscheduler_8h.html#aca736cb6b0319a12bbc4c668d6422eee">PLUGIN_STATUS_UNRUN</a>;
<a name="l00533"></a>00533       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a777794ec935070a82a48a56f3c90e94d">category</a> = category;
<a name="l00534"></a>00534       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a4ed593441d2c19a2d02909ad108df1a2">timeout</a> = nvti_timeout (nvti);
<a name="l00535"></a>00535 
<a name="l00539"></a>00539       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a2012d4e11669f42b4c03c601958c565b">required_ports</a> = str2arglist (nvti_required_ports (nvti));
<a name="l00540"></a>00540       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a1bba16c530813d7fdb7bbdfc9ada12c7">required_udp_ports</a> = str2arglist (nvti_required_udp_ports (nvti));
<a name="l00541"></a>00541       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a41947d81358b2b598306124027893acd">required_keys</a> = str2arglist (nvti_required_keys (nvti));
<a name="l00542"></a>00542       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#ad57d2c0ea7d71e10865f8578adc41043">mandatory_keys</a> = str2arglist (nvti_mandatory_keys (nvti));
<a name="l00543"></a>00543       scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a9e2b7c2c9e9bb660400d168660394a46">excluded_keys</a> = str2arglist (nvti_excluded_keys (nvti));
<a name="l00544"></a>00544 
<a name="l00545"></a>00545       nvti_free (nvti);
<a name="l00546"></a>00546 
<a name="l00547"></a>00547       <span class="keywordflow">if</span> (category &gt; ACT_LAST)
<a name="l00548"></a>00548         category = ACT_LAST;
<a name="l00549"></a>00549       dup = emalloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structlist.html">list</a>));
<a name="l00550"></a>00550       dup-&gt;<a class="code" href="structlist.html#ae50ae628ef9cb3e3eaa2a2ab9a045e8b">name</a> = scheduler_plugin-&gt;<a class="code" href="structscheduler__plugin.html#a59c91d46136c4a0d21c0f7937515dfff">arglist</a>-&gt;name;
<a name="l00551"></a>00551       dup-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a> = scheduler_plugin;
<a name="l00552"></a>00552       dup-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> = NULL;
<a name="l00553"></a>00553       dup-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> = ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category];
<a name="l00554"></a>00554       <span class="keywordflow">if</span> (ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category] != NULL)
<a name="l00555"></a>00555         ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category]-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> = dup;
<a name="l00556"></a>00556       ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category] = dup;
<a name="l00557"></a>00557 
<a name="l00558"></a>00558       hash_add (ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a41c25c435ba066ae4943940c61cbdba3">hash</a>, arg-&gt;<a class="code" href="structhash.html#af12b22b8b50d209af99ff88aa7646304">name</a>, scheduler_plugin);
<a name="l00559"></a>00559       arg = arg-&gt;next;
<a name="l00560"></a>00560     }
<a name="l00561"></a>00561 
<a name="l00562"></a>00562   <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="pluginscheduler_8c.html#aab1b90f59dc5a2902b083c30abd7ff36">HASH_MAX</a>; i++)
<a name="l00563"></a>00563     {
<a name="l00564"></a>00564       l = &amp;ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a41c25c435ba066ae4943940c61cbdba3">hash</a>[i];
<a name="l00565"></a>00565       <span class="keywordflow">while</span> (l != NULL)
<a name="l00566"></a>00566         {
<a name="l00567"></a>00567           hash_fill_deps (ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a41c25c435ba066ae4943940c61cbdba3">hash</a>, l);
<a name="l00568"></a>00568           l = l-&gt;<a class="code" href="structhash.html#a7f2b3b9848204aabd742caaeb79a992f">next</a>;
<a name="l00569"></a>00569         }
<a name="l00570"></a>00570     }
<a name="l00571"></a>00571 
<a name="l00572"></a>00572   <span class="keywordflow">if</span> (autoload != 0)
<a name="l00573"></a>00573     {
<a name="l00574"></a>00574       arg = plugins;
<a name="l00575"></a>00575       <span class="keywordflow">while</span> (arg-&gt;next != NULL)
<a name="l00576"></a>00576         {
<a name="l00577"></a>00577           <span class="comment">/* deps_table is used to prevent circular dependencies. */</span>
<a name="l00578"></a>00578           GHashTable *deps_table;
<a name="l00579"></a>00579 
<a name="l00580"></a>00580           deps_table = g_hash_table_new_full (g_str_hash, g_str_equal, g_free,
<a name="l00581"></a>00581                                               NULL);
<a name="l00582"></a>00582           <span class="keywordflow">if</span> (plug_get_launch (arg-&gt;value) != <a class="code" href="pluginscheduler_8h.html#af8e652e00c7282bbced045f3a6df21e6" title="States of scheduler_plugin.">LAUNCH_DISABLED</a>)
<a name="l00583"></a>00583             enable_plugin_and_dependencies (ret, arg-&gt;value, arg-&gt;name,
<a name="l00584"></a>00584                                             deps_table);
<a name="l00585"></a>00585           arg = arg-&gt;next;
<a name="l00586"></a>00586           g_hash_table_destroy (deps_table);
<a name="l00587"></a>00587         }
<a name="l00588"></a>00588     }
<a name="l00589"></a>00589 
<a name="l00590"></a>00590   <span class="comment">/* Now, remove the plugins that won&apos;t be launched */</span>
<a name="l00591"></a>00591   <span class="keywordflow">for</span> (i = ACT_FIRST; i &lt;= ACT_LAST; i++)
<a name="l00592"></a>00592     {
<a name="l00593"></a>00593       <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l = ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[i];
<a name="l00594"></a>00594       <span class="keywordflow">while</span> (l != NULL)
<a name="l00595"></a>00595         {
<a name="l00596"></a>00596           <span class="keywordflow">if</span> (plug_get_launch (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a59c91d46136c4a0d21c0f7937515dfff">arglist</a>-&gt;value) == <a class="code" href="pluginscheduler_8h.html#af8e652e00c7282bbced045f3a6df21e6" title="States of scheduler_plugin.">LAUNCH_DISABLED</a>)
<a name="l00597"></a>00597             {
<a name="l00598"></a>00598               <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *old = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00599"></a>00599 
<a name="l00600"></a>00600               <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> != NULL)
<a name="l00601"></a>00601                 l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a>-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00602"></a>00602               <span class="keywordflow">else</span>
<a name="l00603"></a>00603                 ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[i] = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00604"></a>00604 
<a name="l00605"></a>00605               <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> != NULL)
<a name="l00606"></a>00606                 l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> = l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a>;
<a name="l00607"></a>00607 
<a name="l00608"></a>00608               efree (&amp;l);
<a name="l00609"></a>00609               l = old;
<a name="l00610"></a>00610               <span class="keywordflow">continue</span>;
<a name="l00611"></a>00611             }
<a name="l00612"></a>00612           l = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614     }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616   <span class="keywordflow">if</span> (only_network)
<a name="l00617"></a>00617     {
<a name="l00618"></a>00618       <span class="keywordflow">for</span> (i = ACT_GATHER_INFO; i &lt;= ACT_LAST; i++)
<a name="l00619"></a>00619         {
<a name="l00620"></a>00620           ret-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[i] = NULL;
<a name="l00621"></a>00621         }
<a name="l00622"></a>00622     }
<a name="l00623"></a>00623   <span class="keywordflow">return</span> ret;
<a name="l00624"></a>00624 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="acf304047d9f645137e28741395add3f9"></a><!-- doxytag: member="pluginscheduler.c::plugins_scheduler_next" ref="acf304047d9f645137e28741395add3f9" args="(plugins_scheduler_t h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a>* plugins_scheduler_next </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td>
          <td class="paramname"> <em>h</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00629">629</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00045">scheduler_plugin::category</a>, <a class="el" href="pluginscheduler_8h_source.html#l00072">hash::dependencies_ptr</a>, <a class="el" href="pluginscheduler_8h_source.html#l00096">plugins_scheduler_struct::list</a>, <a class="el" href="pluginscheduler_8h_source.html#l00081">list::next</a>, <a class="el" href="pluginscheduler_8h_source.html#l00053">scheduler_plugin::parent_hash</a>, <a class="el" href="pluginscheduler_8h_source.html#l00105">PLUG_RUNNING</a>, <a class="el" href="pluginscheduler_8h_source.html#l00080">list::plugin</a>, <a class="el" href="pluginscheduler_8c_source.html#l00073">plugin_get_running_state()</a>, <a class="el" href="pluginscheduler_8c_source.html#l00400">plugin_next_unrun_dependencie()</a>, <a class="el" href="pluginscheduler_8c_source.html#l00079">plugin_set_running_state()</a>, <a class="el" href="pluginscheduler_8h_source.html#l00108">PLUGIN_STATUS_DONE</a>, <a class="el" href="pluginscheduler_8h_source.html#l00109">PLUGIN_STATUS_DONE_AND_CLEANED</a>, <a class="el" href="pluginscheduler_8h_source.html#l00107">PLUGIN_STATUS_RUNNING</a>, <a class="el" href="pluginscheduler_8h_source.html#l00106">PLUGIN_STATUS_UNRUN</a>, <a class="el" href="pluginlaunch_8c_source.html#l00428">pluginlaunch_disable_parrallel_checks()</a>, <a class="el" href="pluginlaunch_8c_source.html#l00434">pluginlaunch_enable_parrallel_checks()</a>, <a class="el" href="pluginlaunch_8c_source.html#l00557">pluginlaunch_wait_for_free_process()</a>, <a class="el" href="pluginscheduler_8h_source.html#l00082">list::prev</a>, <a class="el" href="pluginscheduler_8c_source.html#l00331">scheduler_mark_running_ports()</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00361">scheduler_rm_running_ports()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00630"></a>00630 {
<a name="l00631"></a>00631   <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l;
<a name="l00632"></a>00632   <span class="keywordtype">int</span> category;
<a name="l00633"></a>00633   <span class="keywordtype">int</span> running_category = ACT_LAST;
<a name="l00634"></a>00634   <span class="keywordtype">int</span> flag = 0;
<a name="l00635"></a>00635 
<a name="l00636"></a>00636   <span class="keywordflow">if</span> (h == NULL)
<a name="l00637"></a>00637     <span class="keywordflow">return</span> NULL;
<a name="l00638"></a>00638 
<a name="l00639"></a>00639   <span class="keywordflow">for</span> (category = ACT_FIRST; category &lt;= ACT_LAST; category++)
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       l = h-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category];
<a name="l00642"></a>00642 
<a name="l00643"></a>00643       <span class="comment">/*</span>
<a name="l00644"></a>00644 <span class="comment">       * Scanners (and DoS) must not be run in parallel</span>
<a name="l00645"></a>00645 <span class="comment">       */</span>
<a name="l00646"></a>00646       <span class="keywordflow">if</span> ((category == ACT_SCANNER) || (category == ACT_KILL_HOST)
<a name="l00647"></a>00647           || (category == ACT_FLOOD) || (category == ACT_DENIAL))
<a name="l00648"></a>00648         <a class="code" href="pluginlaunch_8c.html#a663965b54ec6d1d1e0a3542c1101401f">pluginlaunch_disable_parrallel_checks</a> ();
<a name="l00649"></a>00649       <span class="keywordflow">else</span>
<a name="l00650"></a>00650         <a class="code" href="pluginlaunch_8c.html#aed481b716e1b4a222d0f3f4cbae7d3aa">pluginlaunch_enable_parrallel_checks</a> ();
<a name="l00651"></a>00651 
<a name="l00652"></a>00652       <span class="keywordflow">while</span> (l != NULL)
<a name="l00653"></a>00653         {
<a name="l00654"></a>00654           <span class="keywordtype">int</span> state;
<a name="l00655"></a>00655 
<a name="l00656"></a>00656           state = <a class="code" href="pluginscheduler_8c.html#a1327a8b5ad2cf52ed74f69b0c2ad35da">plugin_get_running_state</a> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>);
<a name="l00657"></a>00657 
<a name="l00658"></a>00658           <span class="keywordflow">switch</span> (state)
<a name="l00659"></a>00659             {
<a name="l00660"></a>00660             <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#aca736cb6b0319a12bbc4c668d6422eee">PLUGIN_STATUS_UNRUN</a>:
<a name="l00661"></a>00661               {
<a name="l00662"></a>00662                 <span class="keyword">struct </span><a class="code" href="structhash.html">hash</a> **deps_ptr =
<a name="l00663"></a>00663                   l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a272e99837c57ec46da1ab45b0234f877">parent_hash</a>-&gt;<a class="code" href="structhash.html#a91510ec77e4855486dd6b5002df984b6">dependencies_ptr</a>;
<a name="l00664"></a>00664 
<a name="l00665"></a>00665                 <span class="keywordflow">if</span> (deps_ptr != NULL)
<a name="l00666"></a>00666                   {
<a name="l00667"></a>00667                     <span class="keyword">struct </span><a class="code" href="structscheduler__plugin.html">scheduler_plugin</a> *p =
<a name="l00668"></a>00668                       <a class="code" href="pluginscheduler_8c.html#ab8f94ad31e3c0272e1b035cedf241c9c">plugin_next_unrun_dependencie</a> (h, deps_ptr);
<a name="l00669"></a>00669 
<a name="l00670"></a>00670                     <span class="keywordflow">switch</span> (GPOINTER_TO_SIZE (p))
<a name="l00671"></a>00671                       {
<a name="l00672"></a>00672                       <span class="keywordflow">case</span> GPOINTER_TO_SIZE (NULL):
<a name="l00673"></a>00673                         <a class="code" href="pluginscheduler_8c.html#a7052f46503eccd2e8c61edeb9a6f738e">scheduler_mark_running_ports</a> (h, l-&gt;plugin);
<a name="l00674"></a>00674                         <a class="code" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>,
<a name="l00675"></a>00675                                                   <a class="code" href="pluginscheduler_8h.html#a38c038dee89b59d1c35b89fa1975d1b8">PLUGIN_STATUS_RUNNING</a>);
<a name="l00676"></a>00676                         <span class="keywordflow">return</span> l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>;
<a name="l00677"></a>00677 
<a name="l00678"></a>00678                         <span class="keywordflow">break</span>;
<a name="l00679"></a>00679                       <span class="keywordflow">case</span> GPOINTER_TO_SIZE (<a class="code" href="pluginscheduler_8h.html#acecedc546dd6874231d0a3a7b8b2efc1">PLUG_RUNNING</a>):
<a name="l00680"></a>00680                         {
<a name="l00681"></a>00681                           <span class="comment">/* One of the dependencie is still running  -  we write down its category */</span>
<a name="l00682"></a>00682                           <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a777794ec935070a82a48a56f3c90e94d">category</a> &lt; running_category)
<a name="l00683"></a>00683                             running_category = l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a777794ec935070a82a48a56f3c90e94d">category</a>;
<a name="l00684"></a>00684                           flag++;
<a name="l00685"></a>00685                         }
<a name="l00686"></a>00686                         <span class="keywordflow">break</span>;
<a name="l00687"></a>00687                       <span class="keywordflow">default</span>:
<a name="l00688"></a>00688                         {
<a name="l00689"></a>00689                           <span class="comment">/* Launch a dependencie  - don&apos;t pay attention to the type */</span>
<a name="l00690"></a>00690                           <a class="code" href="pluginscheduler_8c.html#a7052f46503eccd2e8c61edeb9a6f738e">scheduler_mark_running_ports</a> (h, p);
<a name="l00691"></a>00691                           <a class="code" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (p, <a class="code" href="pluginscheduler_8h.html#a38c038dee89b59d1c35b89fa1975d1b8">PLUGIN_STATUS_RUNNING</a>);
<a name="l00692"></a>00692                           <span class="keywordflow">return</span> p;
<a name="l00693"></a>00693                         }
<a name="l00694"></a>00694                       }
<a name="l00695"></a>00695                   }
<a name="l00696"></a>00696                 <span class="keywordflow">else</span>            <span class="comment">/* No dependencies */</span>
<a name="l00697"></a>00697                   {
<a name="l00698"></a>00698                     <a class="code" href="pluginscheduler_8c.html#a7052f46503eccd2e8c61edeb9a6f738e">scheduler_mark_running_ports</a> (h, l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>);
<a name="l00699"></a>00699                     <a class="code" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>, <a class="code" href="pluginscheduler_8h.html#a38c038dee89b59d1c35b89fa1975d1b8">PLUGIN_STATUS_RUNNING</a>);
<a name="l00700"></a>00700                     <span class="keywordflow">return</span> l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>;
<a name="l00701"></a>00701                   }
<a name="l00702"></a>00702               }
<a name="l00703"></a>00703               <span class="keywordflow">break</span>;
<a name="l00704"></a>00704             <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#a38c038dee89b59d1c35b89fa1975d1b8">PLUGIN_STATUS_RUNNING</a>:
<a name="l00705"></a>00705               {
<a name="l00706"></a>00706                 <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a777794ec935070a82a48a56f3c90e94d">category</a> &lt; running_category)
<a name="l00707"></a>00707                   running_category = l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>-&gt;<a class="code" href="structscheduler__plugin.html#a777794ec935070a82a48a56f3c90e94d">category</a>;
<a name="l00708"></a>00708                 flag++;
<a name="l00709"></a>00709               }
<a name="l00710"></a>00710               <span class="keywordflow">break</span>;
<a name="l00711"></a>00711 
<a name="l00712"></a>00712             <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#aaeac17a54597641bba55b1cc58d0d512">PLUGIN_STATUS_DONE</a>:
<a name="l00713"></a>00713               <a class="code" href="pluginscheduler_8c.html#a3b2be4a743db575b34c6bcc8d6ea4a12">scheduler_rm_running_ports</a> (h, l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>);
<a name="l00714"></a>00714               <a class="code" href="pluginscheduler_8c.html#a0009aa6c7d451e7c50fd5589dcc5a998">plugin_set_running_state</a> (l-&gt;<a class="code" href="structlist.html#aa44727f25774053498ac12c1a01c4d3a">plugin</a>,
<a name="l00715"></a>00715                                         <a class="code" href="pluginscheduler_8h.html#a80c6adef8193e7aff1ea19b90cf0b0d9">PLUGIN_STATUS_DONE_AND_CLEANED</a>);
<a name="l00716"></a>00716               <span class="comment">/* no break - we remove it right away */</span>
<a name="l00717"></a>00717             <span class="keywordflow">case</span> <a class="code" href="pluginscheduler_8h.html#a80c6adef8193e7aff1ea19b90cf0b0d9">PLUGIN_STATUS_DONE_AND_CLEANED</a>:
<a name="l00718"></a>00718               {
<a name="l00719"></a>00719                 <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *old = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00720"></a>00720 
<a name="l00721"></a>00721                 <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> != NULL)
<a name="l00722"></a>00722                   l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a>-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00723"></a>00723                 <span class="keywordflow">else</span>
<a name="l00724"></a>00724                   h-&gt;<a class="code" href="structplugins__scheduler__struct.html#a8a43e1a8fde31daffb8f9d294e8e45c0">list</a>[category] = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00725"></a>00725 
<a name="l00726"></a>00726                 <span class="keywordflow">if</span> (l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a> != NULL)
<a name="l00727"></a>00727                   l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a> = l-&gt;<a class="code" href="structlist.html#a73a574e77e33196672eccba15cd1b9ec">prev</a>;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729                 efree (&amp;l);
<a name="l00730"></a>00730                 l = old;
<a name="l00731"></a>00731 
<a name="l00732"></a>00732                 <span class="keywordflow">continue</span>;
<a name="l00733"></a>00733               }
<a name="l00734"></a>00734               <span class="keywordflow">break</span>;
<a name="l00735"></a>00735             }
<a name="l00736"></a>00736           l = l-&gt;<a class="code" href="structlist.html#a1900fe79e875e2838625b2eb60837f8f">next</a>;
<a name="l00737"></a>00737         }
<a name="l00738"></a>00738 
<a name="l00739"></a>00739 
<a name="l00740"></a>00740       <span class="comment">/* Could not find anything */</span>
<a name="l00741"></a>00741       <span class="keywordflow">if</span> ((category == ACT_SCANNER || category == ACT_INIT
<a name="l00742"></a>00742            || category == ACT_SETTINGS) &amp;&amp; flag != 0)
<a name="l00743"></a>00743         {
<a name="l00744"></a>00744           <a class="code" href="pluginlaunch_8c.html#a58c9370449452d4bfbc694686c5f2646" title="Waits and &amp;#39;pushes&amp;#39; processes until the number of running processes has changed...">pluginlaunch_wait_for_free_process</a> ();
<a name="l00745"></a>00745           flag = 0;
<a name="l00746"></a>00746           category--;
<a name="l00747"></a>00747         }
<a name="l00748"></a>00748 
<a name="l00749"></a>00749       <span class="keywordflow">if</span> (category + 1 &gt;= ACT_DENIAL &amp;&amp; flag &amp;&amp; running_category &lt; ACT_DENIAL)
<a name="l00750"></a>00750         {
<a name="l00751"></a>00751           <span class="keywordflow">return</span> <a class="code" href="pluginscheduler_8h.html#acecedc546dd6874231d0a3a7b8b2efc1">PLUG_RUNNING</a>;
<a name="l00752"></a>00752         }
<a name="l00753"></a>00753     }
<a name="l00754"></a>00754 
<a name="l00755"></a>00755 
<a name="l00756"></a>00756   <span class="keywordflow">return</span> flag != 0 ? <a class="code" href="pluginscheduler_8h.html#acecedc546dd6874231d0a3a7b8b2efc1">PLUG_RUNNING</a> : NULL;
<a name="l00757"></a>00757 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a7052f46503eccd2e8c61edeb9a6f738e"></a><!-- doxytag: member="pluginscheduler.c::scheduler_mark_running_ports" ref="a7052f46503eccd2e8c61edeb9a6f738e" args="(plugins_scheduler_t sched, struct scheduler_plugin *plugin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scheduler_mark_running_ports </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00331">331</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00087">plist::name</a>, <a class="el" href="pluginscheduler_8h_source.html#l00089">plist::next</a>, <a class="el" href="pluginscheduler_8h_source.html#l00088">plist::occurences</a>, <a class="el" href="pluginscheduler_8h_source.html#l00053">scheduler_plugin::parent_hash</a>, <a class="el" href="pluginscheduler_8c_source.html#l00309">pl_get()</a>, <a class="el" href="pluginscheduler_8h_source.html#l00097">plugins_scheduler_struct::plist</a>, <a class="el" href="pluginscheduler_8h_source.html#l00073">hash::ports</a>, and <a class="el" href="pluginscheduler_8h_source.html#l00090">plist::prev</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00629">plugins_scheduler_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00333"></a>00333 {
<a name="l00334"></a>00334   <span class="keywordtype">char</span> **ports = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a272e99837c57ec46da1ab45b0234f877">parent_hash</a>-&gt;<a class="code" href="structhash.html#a9282f73e577a7e7e1d41372fd34aedf8">ports</a>;
<a name="l00335"></a>00335   <span class="keywordtype">int</span> i;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337   <span class="keywordflow">if</span> (ports == NULL)
<a name="l00338"></a>00338     <span class="keywordflow">return</span>;
<a name="l00339"></a>00339 
<a name="l00340"></a>00340   <span class="keywordflow">for</span> (i = 0; ports[i] != NULL; i++)
<a name="l00341"></a>00341     {
<a name="l00342"></a>00342       <span class="keyword">struct </span><a class="code" href="structplist.html">plist</a> *pl = <a class="code" href="pluginscheduler_8c.html#a21138b699c77f747b0e13612914709b5">pl_get</a> (sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a>, ports[i]);
<a name="l00343"></a>00343 
<a name="l00344"></a>00344       <span class="keywordflow">if</span> (pl != NULL)
<a name="l00345"></a>00345         pl-&gt;<a class="code" href="structplist.html#ac92d12ba17ddaee009b4e1197c70019e">occurences</a>++;
<a name="l00346"></a>00346       <span class="keywordflow">else</span>
<a name="l00347"></a>00347         {
<a name="l00348"></a>00348           pl = emalloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> <a class="code" href="structplist.html">plist</a>));
<a name="l00349"></a>00349           strncpy (pl-&gt;<a class="code" href="structplist.html#ad8d52ccb86142d47a88d314921d299e7">name</a>, ports[i], sizeof (pl-&gt;<a class="code" href="structplist.html#ad8d52ccb86142d47a88d314921d299e7">name</a>) - 1);  <span class="comment">/* Share cache_inc() ? */</span>
<a name="l00350"></a>00350           pl-&gt;<a class="code" href="structplist.html#ac92d12ba17ddaee009b4e1197c70019e">occurences</a> = 1;
<a name="l00351"></a>00351           pl-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a> = sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a>;
<a name="l00352"></a>00352           <span class="keywordflow">if</span> (sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a> != NULL)
<a name="l00353"></a>00353             sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a>-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a> = pl;
<a name="l00354"></a>00354           pl-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a> = NULL;
<a name="l00355"></a>00355           sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a> = pl;
<a name="l00356"></a>00356         }
<a name="l00357"></a>00357     }
<a name="l00358"></a>00358 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a3b2be4a743db575b34c6bcc8d6ea4a12"></a><!-- doxytag: member="pluginscheduler.c::scheduler_rm_running_ports" ref="a3b2be4a743db575b34c6bcc8d6ea4a12" args="(plugins_scheduler_t sched, struct scheduler_plugin *plugin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void scheduler_rm_running_ports </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structplugins__scheduler__struct.html">plugins_scheduler_t</a>&nbsp;</td>
          <td class="paramname"> <em>sched</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="pluginscheduler_8c_source.html#l00361">361</a> of file <a class="el" href="pluginscheduler_8c_source.html">pluginscheduler.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00089">plist::next</a>, <a class="el" href="pluginscheduler_8h_source.html#l00088">plist::occurences</a>, <a class="el" href="pluginscheduler_8h_source.html#l00053">scheduler_plugin::parent_hash</a>, <a class="el" href="pluginscheduler_8c_source.html#l00309">pl_get()</a>, <a class="el" href="pluginscheduler_8h_source.html#l00097">plugins_scheduler_struct::plist</a>, <a class="el" href="pluginscheduler_8h_source.html#l00073">hash::ports</a>, and <a class="el" href="pluginscheduler_8h_source.html#l00090">plist::prev</a>.</p>

<p>Referenced by <a class="el" href="pluginscheduler_8c_source.html#l00400">plugin_next_unrun_dependencie()</a>, and <a class="el" href="pluginscheduler_8c_source.html#l00629">plugins_scheduler_next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00363"></a>00363 {
<a name="l00364"></a>00364   <span class="keywordtype">char</span> **ports;
<a name="l00365"></a>00365   <span class="keywordtype">int</span> i;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367   ports = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a272e99837c57ec46da1ab45b0234f877">parent_hash</a>-&gt;<a class="code" href="structhash.html#a9282f73e577a7e7e1d41372fd34aedf8">ports</a>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369   <span class="keywordflow">if</span> (ports == NULL)
<a name="l00370"></a>00370     <span class="keywordflow">return</span>;
<a name="l00371"></a>00371 
<a name="l00372"></a>00372   <span class="keywordflow">for</span> (i = 0; ports[i] != NULL; i++)
<a name="l00373"></a>00373     {
<a name="l00374"></a>00374       <span class="keyword">struct </span><a class="code" href="structplist.html">plist</a> *pl = <a class="code" href="pluginscheduler_8c.html#a21138b699c77f747b0e13612914709b5">pl_get</a> (sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a>, ports[i]);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376       <span class="keywordflow">if</span> (pl != NULL)
<a name="l00377"></a>00377         {
<a name="l00378"></a>00378           pl-&gt;<a class="code" href="structplist.html#ac92d12ba17ddaee009b4e1197c70019e">occurences</a>--;
<a name="l00379"></a>00379           <span class="keywordflow">if</span> (pl-&gt;<a class="code" href="structplist.html#ac92d12ba17ddaee009b4e1197c70019e">occurences</a> == 0)
<a name="l00380"></a>00380             {
<a name="l00381"></a>00381               <span class="keywordflow">if</span> (pl-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a> != NULL)
<a name="l00382"></a>00382                 pl-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a>-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a> = pl-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a>;
<a name="l00383"></a>00383 
<a name="l00384"></a>00384               <span class="keywordflow">if</span> (pl-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a> != NULL)
<a name="l00385"></a>00385                 pl-&gt;<a class="code" href="structplist.html#abab17de80d9faf1943a434506e36baa3">prev</a>-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a> = pl-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a>;
<a name="l00386"></a>00386               <span class="keywordflow">else</span>
<a name="l00387"></a>00387                 sched-&gt;<a class="code" href="structplugins__scheduler__struct.html#a2b2331b133be4c89802b87bc214bffb4">plist</a> = pl-&gt;<a class="code" href="structplist.html#a3c2c370858b9d71608b0ff250853c9e9">next</a>;
<a name="l00388"></a>00388 
<a name="l00389"></a>00389               efree (&amp;pl);
<a name="l00390"></a>00390             }
<a name="l00391"></a>00391         }
<a name="l00392"></a>00392       <span class="keywordflow">else</span>
<a name="l00393"></a>00393         printf (<span class="stringliteral">&quot;Warning: scheduler_rm_running_ports failed ?! (%s)\n&quot;</span>,
<a name="l00394"></a>00394                 ports[i]);
<a name="l00395"></a>00395     }
<a name="l00396"></a>00396 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Oct 2015 for OpenVAS Scanner by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
