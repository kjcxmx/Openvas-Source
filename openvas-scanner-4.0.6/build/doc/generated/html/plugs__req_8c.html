<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenVAS Scanner: src/plugs_req.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_1c445093eb429e71cff849a5afa0a294.html">src</a>
  </div>
</div>
<div class="contents">
<h1>plugs_req.c File Reference</h1><code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;openvas/misc/system.h&gt;</code><br/>
<code>#include &quot;<a class="el" href="pluginscheduler_8h_source.html">pluginscheduler.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="plugs__req_8h_source.html">plugs_req.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for plugs_req.c:</div>
<div class="dynsection">
</div>

<p><a href="plugs__req_8c_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="plugs__req_8c.html#a8924e6fed5e189cb98b0ab1ee3a7fa4a">kb_get_port_state_proto</a> (kb_t, struct arglist *, int, char *)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct arglist *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="plugs__req_8c.html#ab476e5a6c3241fac8ce2f78ae8320e7d">requirements_common_ports</a> (struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin1, struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin2)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Returns &lt;port&gt; if the lists of the required ports between.  <a href="#ab476e5a6c3241fac8ce2f78ae8320e7d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="plugs__req_8c.html#a5247439e43e3f64d3290a99308b487a8">mandatory_requirements_met</a> (kb_t kb, struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Check whether mandatory requirements for plugin are met.  <a href="#a5247439e43e3f64d3290a99308b487a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="plugs__req_8c.html#af3a9dcb1425cf4cf449988465a96b478">requirements_plugin</a> (kb_t kb, struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *plugin, struct arglist *preferences)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Determine if the plugin requirements are met.  <a href="#af3a9dcb1425cf4cf449988465a96b478"></a><br/></td></tr>
</table>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a8924e6fed5e189cb98b0ab1ee3a7fa4a"></a><!-- doxytag: member="plugs_req.c::kb_get_port_state_proto" ref="a8924e6fed5e189cb98b0ab1ee3a7fa4a" args="(kb_t, struct arglist *, int, char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int kb_get_port_state_proto </td>
          <td>(</td>
          <td class="paramtype">kb_t&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct arglist *&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<a class="anchor" id="a5247439e43e3f64d3290a99308b487a8"></a><!-- doxytag: member="plugs_req.c::mandatory_requirements_met" ref="a5247439e43e3f64d3290a99308b487a8" args="(kb_t kb, struct scheduler_plugin *plugin)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int mandatory_requirements_met </td>
          <td>(</td>
          <td class="paramtype">kb_t&nbsp;</td>
          <td class="paramname"> <em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check whether mandatory requirements for plugin are met. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>kb</em>&nbsp;</td><td>The arglist knowledge base with all keys.</td></tr>
    <tr><td valign="top"></td><td valign="top"><em>plugin</em>&nbsp;</td><td>The arglist plugin.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>1 if all mandatory requirements for the plugin are met. 0 if it is not the case. </dd></dl>

<p>Definition at line <a class="el" href="plugs__req_8c_source.html#l00202">202</a> of file <a class="el" href="plugs__req_8c_source.html">plugs_req.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00050">scheduler_plugin::mandatory_keys</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00204"></a>00204 {
<a name="l00205"></a>00205   <span class="keywordflow">if</span> (key_missing (kb, plugin-&gt;<a class="code" href="structscheduler__plugin.html#ad57d2c0ea7d71e10865f8578adc41043">mandatory_keys</a>))
<a name="l00206"></a>00206     <span class="keywordflow">return</span> 0;
<a name="l00207"></a>00207 
<a name="l00208"></a>00208   <span class="keywordflow">return</span> 1;
<a name="l00209"></a>00209 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="ab476e5a6c3241fac8ce2f78ae8320e7d"></a><!-- doxytag: member="plugs_req.c::requirements_common_ports" ref="ab476e5a6c3241fac8ce2f78ae8320e7d" args="(struct scheduler_plugin *plugin1, struct scheduler_plugin *plugin2)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct arglist* requirements_common_ports </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin2</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [read]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Returns &lt;port&gt; if the lists of the required ports between. </p>
<p>plugin 1 and plugin 2 have at least one port in common. </p>

<p>Definition at line <a class="el" href="plugs__req_8c_source.html#l00151">151</a> of file <a class="el" href="plugs__req_8c_source.html">plugs_req.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00047">scheduler_plugin::required_ports</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00153"></a>00153 {
<a name="l00154"></a>00154   <span class="keyword">struct </span>arglist *ret = NULL;
<a name="l00155"></a>00155   <span class="keyword">struct </span>arglist *req1;
<a name="l00156"></a>00156   <span class="keyword">struct </span>arglist *req2;
<a name="l00157"></a>00157 
<a name="l00158"></a>00158   <span class="keywordflow">if</span> (!plugin1 || !plugin2)
<a name="l00159"></a>00159     <span class="keywordflow">return</span> 0;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   req1 = plugin1-&gt;<a class="code" href="structscheduler__plugin.html#a2012d4e11669f42b4c03c601958c565b">required_ports</a>;
<a name="l00162"></a>00162   <span class="keywordflow">if</span> (req1 == NULL)
<a name="l00163"></a>00163     <span class="keywordflow">return</span> 0;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165   req2 = plugin2-&gt;<a class="code" href="structscheduler__plugin.html#a2012d4e11669f42b4c03c601958c565b">required_ports</a>;
<a name="l00166"></a>00166   <span class="keywordflow">if</span> (req2 == NULL)
<a name="l00167"></a>00167     <span class="keywordflow">return</span> 0;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordflow">while</span> (req1-&gt;next != NULL)
<a name="l00170"></a>00170     {
<a name="l00171"></a>00171       <span class="keyword">struct </span>arglist *r = req2;
<a name="l00172"></a>00172       <span class="keywordflow">if</span> (r != NULL)
<a name="l00173"></a>00173         <span class="keywordflow">while</span> (r-&gt;next != NULL)
<a name="l00174"></a>00174           {
<a name="l00175"></a>00175             <span class="keywordflow">if</span> (req1-&gt;type == r-&gt;type)
<a name="l00176"></a>00176               {
<a name="l00177"></a>00177                 <span class="keywordflow">if</span> (r-&gt;name &amp;&amp; req1-&gt;name &amp;&amp; !strcmp (r-&gt;name, req1-&gt;name))
<a name="l00178"></a>00178                   {
<a name="l00179"></a>00179                     <span class="keywordflow">if</span> (!ret)
<a name="l00180"></a>00180                       ret = emalloc (<span class="keyword">sizeof</span> (<span class="keyword">struct</span> arglist));
<a name="l00181"></a>00181                     arg_add_value (ret, r-&gt;name, ARG_INT, 0, (<span class="keywordtype">void</span> *) 1);
<a name="l00182"></a>00182                   }
<a name="l00183"></a>00183               }
<a name="l00184"></a>00184             r = r-&gt;next;
<a name="l00185"></a>00185           }
<a name="l00186"></a>00186       req1 = req1-&gt;next;
<a name="l00187"></a>00187     }
<a name="l00188"></a>00188   <span class="keywordflow">return</span> ret;
<a name="l00189"></a>00189 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="af3a9dcb1425cf4cf449988465a96b478"></a><!-- doxytag: member="plugs_req.c::requirements_plugin" ref="af3a9dcb1425cf4cf449988465a96b478" args="(kb_t kb, struct scheduler_plugin *plugin, struct arglist *preferences)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* requirements_plugin </td>
          <td>(</td>
          <td class="paramtype">kb_t&nbsp;</td>
          <td class="paramname"> <em>kb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structscheduler__plugin.html">scheduler_plugin</a> *&nbsp;</td>
          <td class="paramname"> <em>plugin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct arglist *&nbsp;</td>
          <td class="paramname"> <em>preferences</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Determine if the plugin requirements are met. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Returns NULL is everything is ok, else an error message. </dd></dl>

<p>Definition at line <a class="el" href="plugs__req_8c_source.html#l00217">217</a> of file <a class="el" href="plugs__req_8c_source.html">plugs_req.c</a>.</p>

<p>References <a class="el" href="pluginscheduler_8h_source.html#l00051">scheduler_plugin::excluded_keys</a>, <a class="el" href="pluginscheduler_8h_source.html#l00049">scheduler_plugin::required_keys</a>, <a class="el" href="pluginscheduler_8h_source.html#l00047">scheduler_plugin::required_ports</a>, and <a class="el" href="pluginscheduler_8h_source.html#l00048">scheduler_plugin::required_udp_ports</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00219"></a>00219 {
<a name="l00220"></a>00220   <span class="keyword">static</span> <span class="keywordtype">char</span> error[64];
<a name="l00221"></a>00221   <span class="keywordtype">char</span> *missing;
<a name="l00222"></a>00222   <span class="keywordtype">char</span> *present;
<a name="l00223"></a>00223   <span class="keyword">struct </span>arglist *tcp, *udp, *rkeys, *ekeys;
<a name="l00224"></a>00224   <span class="keywordtype">char</span> *opti = arg_get_value (preferences, <span class="stringliteral">&quot;optimization_level&quot;</span>);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226   <span class="comment">/*</span>
<a name="l00227"></a>00227 <span class="comment">   * Check wether the good ports are open</span>
<a name="l00228"></a>00228 <span class="comment">   */</span>
<a name="l00229"></a>00229   error[<span class="keyword">sizeof</span> (error) - 1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00230"></a>00230   tcp = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a2012d4e11669f42b4c03c601958c565b">required_ports</a>;
<a name="l00231"></a>00231   <span class="keywordflow">if</span> (tcp != NULL &amp;&amp; (get_closed_ports (kb, tcp, preferences)) == 0)
<a name="l00232"></a>00232     {
<a name="l00233"></a>00233       strncpy (error, <span class="stringliteral">&quot;none of the required tcp ports are open&quot;</span>,
<a name="l00234"></a>00234                <span class="keyword">sizeof</span> (error) - 1);
<a name="l00235"></a>00235       <span class="keywordflow">return</span> error;
<a name="l00236"></a>00236     }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238   udp = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a1bba16c530813d7fdb7bbdfc9ada12c7">required_udp_ports</a>;
<a name="l00239"></a>00239   <span class="keywordflow">if</span> (udp != NULL &amp;&amp; (get_closed_udp_ports (kb, udp, preferences)) == 0)
<a name="l00240"></a>00240     {
<a name="l00241"></a>00241       strncpy (error, <span class="stringliteral">&quot;none of the required udp ports are open&quot;</span>,
<a name="l00242"></a>00242                <span class="keyword">sizeof</span> (error) - 1);
<a name="l00243"></a>00243       <span class="keywordflow">return</span> error;
<a name="l00244"></a>00244     }
<a name="l00245"></a>00245 
<a name="l00246"></a>00246   <span class="keywordflow">if</span> (opti != NULL &amp;&amp; (strcmp (opti, <span class="stringliteral">&quot;open_ports&quot;</span>) == 0 || atoi (opti) == 1))
<a name="l00247"></a>00247     <span class="keywordflow">return</span> NULL;
<a name="l00248"></a>00248 
<a name="l00249"></a>00249   <span class="comment">/*</span>
<a name="l00250"></a>00250 <span class="comment">   * Check wether a key we wanted is missing</span>
<a name="l00251"></a>00251 <span class="comment">   */</span>
<a name="l00252"></a>00252   rkeys = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a41947d81358b2b598306124027893acd">required_keys</a>;
<a name="l00253"></a>00253   <span class="keywordflow">if</span> ((missing = key_missing (kb, rkeys)))
<a name="l00254"></a>00254     {
<a name="l00255"></a>00255       snprintf (error, <span class="keyword">sizeof</span> (error), <span class="stringliteral">&quot;because the key %s is missing&quot;</span>,
<a name="l00256"></a>00256                 missing);
<a name="l00257"></a>00257       <span class="keywordflow">return</span> error;
<a name="l00258"></a>00258     }
<a name="l00259"></a>00259 
<a name="l00260"></a>00260   <span class="keywordflow">if</span> (opti != NULL &amp;&amp; (strcmp (opti, <span class="stringliteral">&quot;required_keys&quot;</span>) == 0 || atoi (opti) == 2))
<a name="l00261"></a>00261     <span class="keywordflow">return</span> NULL;
<a name="l00262"></a>00262 
<a name="l00263"></a>00263   <span class="comment">/*</span>
<a name="l00264"></a>00264 <span class="comment">   * Check wether a key we do not want is present</span>
<a name="l00265"></a>00265 <span class="comment">   */</span>
<a name="l00266"></a>00266   ekeys = plugin-&gt;<a class="code" href="structscheduler__plugin.html#a9e2b7c2c9e9bb660400d168660394a46">excluded_keys</a>;
<a name="l00267"></a>00267   <span class="keywordflow">if</span> ((present = key_present (kb, ekeys)))
<a name="l00268"></a>00268     {
<a name="l00269"></a>00269       snprintf (error, <span class="keyword">sizeof</span> (error), <span class="stringliteral">&quot;because the key %s is present&quot;</span>,
<a name="l00270"></a>00270                 present);
<a name="l00271"></a>00271       <span class="keywordflow">return</span> error;
<a name="l00272"></a>00272     }
<a name="l00273"></a>00273   <span class="keywordflow">return</span> NULL;
<a name="l00274"></a>00274 }
</pre></div></p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Oct 2015 for OpenVAS Scanner by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
