<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>OpenVAS Manager: src/lsc_crypt.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_2e42f16cd70e299165562ff45749e93d.html">src</a>
  </div>
</div>
<div class="contents">
<h1>lsc_crypt.h File Reference</h1><code>#include &lt;glib.h&gt;</code><br/>
<div class="dynheader">
Include dependency graph for lsc_crypt.h:</div>
<div class="dynsection">
</div>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
</div>

<p><a href="lsc__crypt_8h_source.html">Go to the source code of this file.</a></p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_s</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#ac36a2ca11644a5728bd73c7e135b566a">lsc_crypt_ctx_t</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a0d1618fba491ec2d5707545793944d18">lsc_crypt_new</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return a new context for LSC encryption.  <a href="#a0d1618fba491ec2d5707545793944d18"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#aa383411c640ff7e7bfcac95ea1fba084">lsc_crypt_release</a> (<a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Release an LSC encryption context.  <a href="#aa383411c640ff7e7bfcac95ea1fba084"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a20aec9824d6c37f9c133d06347750f69">lsc_crypt_create_key</a> ()</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Create the standard credential encryption key.  <a href="#a20aec9824d6c37f9c133d06347750f69"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a1266a9fd2014242038fe742ed08d3dc0">lsc_crypt_flush</a> (<a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flush an LSC encryption context.  <a href="#a1266a9fd2014242038fe742ed08d3dc0"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a80d28b4404b5cb8edd2588398b142e91">lsc_crypt_encrypt</a> (<a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>, const char *,...) G_GNUC_NULL_TERMINATED</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Encrypt a list of name/value pairs.  <a href="#a80d28b4404b5cb8edd2588398b142e91"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#ab6fce07a5d0e066f2a4361840b72b176">lsc_crypt_get_password</a> (<a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>, const char *)</td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Return an encrypted password in the clear.  <a href="#ab6fce07a5d0e066f2a4361840b72b176"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">const char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a96fa8a8d533f12bb2c4e6328f6e19184">lsc_crypt_get_private_key</a> (<a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>, const char *)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="lsc__crypt_8h.html#a273eb151f932f83e1f641f52e9c1b60c">disable_encrypted_credentials</a></td></tr>
<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Flag indicating that encrypted credentials are disabled.  <a href="#a273eb151f932f83e1f641f52e9c1b60c"></a><br/></td></tr>
</table>
<hr/><h2>Typedef Documentation</h2>
<a class="anchor" id="ac36a2ca11644a5728bd73c7e135b566a"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_ctx_t" ref="ac36a2ca11644a5728bd73c7e135b566a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_s</a>* <a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lsc__crypt_8h_source.html#l00036">36</a> of file <a class="el" href="lsc__crypt_8h_source.html">lsc_crypt.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a20aec9824d6c37f9c133d06347750f69"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_create_key" ref="a20aec9824d6c37f9c133d06347750f69" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int lsc_crypt_create_key </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Create the standard credential encryption key. </p>
<p>This function creates a standard encryption key if such a key does not yet exists. Note, that in general an encryption key is created on-the-fly.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>0 on success, 1 if the key already exists, and -1 for other errors. </dd></dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00553">553</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p>References <a class="el" href="lsc__crypt_8c_source.html#l00511">lsc_crypt_new()</a>, and <a class="el" href="lsc__crypt_8c_source.html#l00532">lsc_crypt_release()</a>.</p>

<p>Referenced by <a class="el" href="openvasmd_8c_source.html#l01269">main()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00554"></a>00554 {
<a name="l00555"></a>00555   <span class="keywordtype">int</span> res = -1;
<a name="l00556"></a>00556   <a class="code" href="structlsc__crypt__ctx__s.html" title="The context object for encryption operations.">lsc_crypt_ctx_t</a> ctx;
<a name="l00557"></a>00557   gpgme_key_t key;
<a name="l00558"></a>00558 
<a name="l00559"></a>00559   ctx = <a class="code" href="lsc__crypt_8c.html#a0d1618fba491ec2d5707545793944d18" title="Return a new context for LSC encryption.">lsc_crypt_new</a> ();
<a name="l00560"></a>00560   key = find_the_key (ctx, TRUE);
<a name="l00561"></a>00561   <span class="keywordflow">if</span> (key)
<a name="l00562"></a>00562     {
<a name="l00563"></a>00563       gpgme_key_unref (key);
<a name="l00564"></a>00564       g_warning (<span class="stringliteral">&quot;A credentials encryption key already exists - &quot;</span>
<a name="l00565"></a>00565                  <span class="stringliteral">&quot;not creating another one.&quot;</span>);
<a name="l00566"></a>00566       res = 1;
<a name="l00567"></a>00567     }
<a name="l00568"></a>00568   <span class="keywordflow">else</span>
<a name="l00569"></a>00569     {
<a name="l00570"></a>00570       <span class="keywordflow">if</span> (!create_the_key (ctx))
<a name="l00571"></a>00571         res = 0;
<a name="l00572"></a>00572     }
<a name="l00573"></a>00573 
<a name="l00574"></a>00574   <a class="code" href="lsc__crypt_8c.html#ae74d739b0aa90471b2ee7da8d415d548" title="Release an LSC encryption context.">lsc_crypt_release</a> (ctx);
<a name="l00575"></a>00575   <span class="keywordflow">return</span> res;
<a name="l00576"></a>00576 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a80d28b4404b5cb8edd2588398b142e91"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_encrypt" ref="a80d28b4404b5cb8edd2588398b142e91" args="(lsc_crypt_ctx_t, const char *,...) G_GNUC_NULL_TERMINATED" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char* lsc_crypt_encrypt </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td>
          <td class="paramname"> <em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>first_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&nbsp;</td>
          <td class="paramname"> <em>...</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Encrypt a list of name/value pairs. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctx</em>&nbsp;</td><td>The context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>first_name</em>&nbsp;</td><td>The name of the first name/value pair. This must be followed by a string value and optionaly followed by more name and value pairs. This list is terminated by a single NULL instead of a name.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A pointer to a freshly allocated string in base64 encoding. Caller must free. On error NULL is returned. </dd></dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00620">620</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p>References <a class="el" href="lsc__crypt_8c_source.html#l00062">MAX_VALUE_LENGTH</a>, and <a class="el" href="lsc__crypt_8c_source.html#l00082">namelist_s::name</a>.</p>

<p>Referenced by <a class="el" href="manage__sql_8c_source.html#l33148">create_lsc_credential()</a>, and <a class="el" href="manage__sql_8c_source.html#l33834">set_lsc_credential_password()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00621"></a>00621 {
<a name="l00622"></a>00622   va_list arg_ptr;
<a name="l00623"></a>00623   GString *stringbuf;
<a name="l00624"></a>00624   <span class="keywordtype">char</span> *plaintext;
<a name="l00625"></a>00625   <span class="keywordtype">size_t</span> plaintextlen;
<a name="l00626"></a>00626   <span class="keywordtype">char</span> *ciphertext;
<a name="l00627"></a>00627   <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="structnamelist__s.html#a10e5f9a9cf791f9201d3a41250b36c3a">name</a>, *<a class="code" href="structnamelist__s.html#a2382546248b3fa55432d922fc5076f19">value</a>;
<a name="l00628"></a>00628   <span class="keywordtype">size_t</span> len;
<a name="l00629"></a>00629 
<a name="l00630"></a>00630   <span class="keywordflow">if</span> (!ctx || !first_name)
<a name="l00631"></a>00631     <span class="keywordflow">return</span> NULL;
<a name="l00632"></a>00632 
<a name="l00633"></a>00633   <span class="comment">/* Assuming a 2048 bit RSA ssh private key in PEM encoding, a buffer</span>
<a name="l00634"></a>00634 <span class="comment">     with an initial size of 2k should be large enough.  */</span>
<a name="l00635"></a>00635   stringbuf = g_string_sized_new (2048);
<a name="l00636"></a>00636 
<a name="l00637"></a>00637   name = first_name;
<a name="l00638"></a>00638   va_start (arg_ptr, first_name);
<a name="l00639"></a>00639   <span class="keywordflow">do</span>
<a name="l00640"></a>00640     {
<a name="l00641"></a>00641       value = va_arg (arg_ptr, <span class="keyword">const</span> <span class="keywordtype">char</span> *);
<a name="l00642"></a>00642       <span class="keywordflow">if</span> (!value)
<a name="l00643"></a>00643         value = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00644"></a>00644       len = strlen (name);
<a name="l00645"></a>00645       <span class="keywordflow">if</span> (len)  <span class="comment">/* We skip pairs with an empty name. */</span>
<a name="l00646"></a>00646         {
<a name="l00647"></a>00647           put32 (stringbuf, len);
<a name="l00648"></a>00648           g_string_append (stringbuf, name);
<a name="l00649"></a>00649           len = strlen (value);
<a name="l00650"></a>00650           <span class="keywordflow">if</span> (len &gt; <a class="code" href="lsc__crypt_8c.html#a73728cb2adf706b78be4cd7ca7c27646" title="The maximum size of an encrypted value.">MAX_VALUE_LENGTH</a>)
<a name="l00651"></a>00651             {
<a name="l00652"></a>00652               g_warning (<span class="stringliteral">&quot;%s: value for &apos;%s&apos; larger than our limit (%d)&quot;</span>,
<a name="l00653"></a>00653                          G_STRFUNC, name, <a class="code" href="lsc__crypt_8c.html#a73728cb2adf706b78be4cd7ca7c27646" title="The maximum size of an encrypted value.">MAX_VALUE_LENGTH</a>);
<a name="l00654"></a>00654               g_string_free (stringbuf, TRUE);
<a name="l00655"></a>00655               va_end (arg_ptr);
<a name="l00656"></a>00656               <span class="keywordflow">return</span> NULL;
<a name="l00657"></a>00657             }
<a name="l00658"></a>00658           put32 (stringbuf, len);
<a name="l00659"></a>00659           g_string_append (stringbuf, value);
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661     }
<a name="l00662"></a>00662   <span class="keywordflow">while</span> ((name = va_arg (arg_ptr, <span class="keyword">const</span> <span class="keywordtype">char</span> *)));
<a name="l00663"></a>00663   va_end (arg_ptr);
<a name="l00664"></a>00664   plaintext = stringbuf-&gt;str;
<a name="l00665"></a>00665   plaintextlen = stringbuf-&gt;len;
<a name="l00666"></a>00666   g_string_free (stringbuf, FALSE);
<a name="l00667"></a>00667   g_assert (plaintextlen);
<a name="l00668"></a>00668 
<a name="l00669"></a>00669   ciphertext = do_encrypt (ctx, plaintext, plaintextlen);
<a name="l00670"></a>00670   g_free (plaintext);
<a name="l00671"></a>00671 
<a name="l00672"></a>00672   <span class="keywordflow">return</span> ciphertext;
<a name="l00673"></a>00673 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="a1266a9fd2014242038fe742ed08d3dc0"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_flush" ref="a1266a9fd2014242038fe742ed08d3dc0" args="(lsc_crypt_ctx_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsc_crypt_flush </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td>
          <td class="paramname"> <em>ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flush an LSC encryption context. </p>
<p>This function is used to flush the context. The flushing invalidates returned strings and internal caches. Basically this is the same as releasing and creating the context but it is optimized to keep some internal state.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctx</em>&nbsp;</td><td>The context or NULL </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00590">590</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p>References <a class="el" href="lsc__crypt_8c_source.html#l00097">lsc_crypt_ctx_s::namelist</a>, <a class="el" href="lsc__crypt_8c_source.html#l00075">namelist_s::next</a>, <a class="el" href="lsc__crypt_8c_source.html#l00095">lsc_crypt_ctx_s::plaintext</a>, and <a class="el" href="lsc__crypt_8c_source.html#l00081">namelist_s::value</a>.</p>

<p>Referenced by <a class="el" href="lsc__crypt_8c_source.html#l00532">lsc_crypt_release()</a>, and <a class="el" href="sql_8c_source.html#l02253">next()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00591"></a>00591 {
<a name="l00592"></a>00592   <span class="keywordflow">if</span> (!ctx)
<a name="l00593"></a>00593     <span class="keywordflow">return</span>;
<a name="l00594"></a>00594   <span class="keywordflow">while</span> (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a29784e91a47ce697dde033756884b9e0">namelist</a>)
<a name="l00595"></a>00595     {
<a name="l00596"></a>00596       <span class="keyword">struct </span><a class="code" href="structnamelist__s.html" title="A linked list to help caching results.">namelist_s</a> *nl = ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a29784e91a47ce697dde033756884b9e0">namelist</a>-&gt;<a class="code" href="structnamelist__s.html#a1be5f6f2df8d3f70ded74bde5d94f5a1">next</a>;
<a name="l00597"></a>00597       g_free (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a29784e91a47ce697dde033756884b9e0">namelist</a>-&gt;<a class="code" href="structnamelist__s.html#a2382546248b3fa55432d922fc5076f19">value</a>);
<a name="l00598"></a>00598       g_free (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a29784e91a47ce697dde033756884b9e0">namelist</a>);
<a name="l00599"></a>00599       ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a29784e91a47ce697dde033756884b9e0">namelist</a> = nl;
<a name="l00600"></a>00600     }
<a name="l00601"></a>00601   g_free (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#abb5d2a695bfb86a8216151ef23d6fd07">plaintext</a>);
<a name="l00602"></a>00602   ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#abb5d2a695bfb86a8216151ef23d6fd07">plaintext</a> = NULL;
<a name="l00603"></a>00603 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="ab6fce07a5d0e066f2a4361840b72b176"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_get_password" ref="ab6fce07a5d0e066f2a4361840b72b176" args="(lsc_crypt_ctx_t, const char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* lsc_crypt_get_password </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td>
          <td class="paramname"> <em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>ciphertext</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return an encrypted password in the clear. </p>
<p>This function returns the encrypted password in the clear. The clear value may also be NULL , if no password is available. If a decryption has not yet been done, the passed <em>ciphertext</em> value is first decrypted. Thus a changed value of ciphertext may not have an effect. To force a decryption a call to <a class="el" href="lsc__crypt_8h.html#a1266a9fd2014242038fe742ed08d3dc0">lsc_crypt_flush</a> is required.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctx</em>&nbsp;</td><td>The context </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ciphertext</em>&nbsp;</td><td>The base64 encoded ciphertest.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A const pointer to a string object. This pointer is valid as long as the context is valid and <a class="el" href="lsc__crypt_8h.html#a1266a9fd2014242038fe742ed08d3dc0">lsc_crypt_flush</a> has not been called. If no password is available NULL is returned. </dd></dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00812">812</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00813"></a>00813 {
<a name="l00814"></a>00814   <span class="keywordflow">return</span> lsc_crypt_decrypt (ctx, ciphertext, <span class="stringliteral">&quot;password&quot;</span>);
<a name="l00815"></a>00815 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a96fa8a8d533f12bb2c4e6328f6e19184"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_get_private_key" ref="a96fa8a8d533f12bb2c4e6328f6e19184" args="(lsc_crypt_ctx_t, const char *)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char* lsc_crypt_get_private_key </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td>
          <td class="paramname">, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00819">819</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00820"></a>00820 {
<a name="l00821"></a>00821   <span class="keywordflow">return</span> lsc_crypt_decrypt (ctx, ciphertext, <span class="stringliteral">&quot;private_key&quot;</span>);
<a name="l00822"></a>00822 }
</pre></div></p>

</div>
</div>
<a class="anchor" id="a0d1618fba491ec2d5707545793944d18"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_new" ref="a0d1618fba491ec2d5707545793944d18" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a> lsc_crypt_new </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Return a new context for LSC encryption. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>A new context object to be released with <a class="el" href="lsc__crypt_8h.html#aa383411c640ff7e7bfcac95ea1fba084">lsc_crypt_release</a>. </dd></dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00511">511</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p>References <a class="el" href="lsc__crypt_8c_source.html#l00093">lsc_crypt_ctx_s::encctx</a>.</p>

<p>Referenced by <a class="el" href="manage__sql_8c_source.html#l33148">create_lsc_credential()</a>, <a class="el" href="lsc__crypt_8c_source.html#l00553">lsc_crypt_create_key()</a>, and <a class="el" href="manage__sql_8c_source.html#l33834">set_lsc_credential_password()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00512"></a>00512 {
<a name="l00513"></a>00513   <a class="code" href="structlsc__crypt__ctx__s.html" title="The context object for encryption operations.">lsc_crypt_ctx_t</a> ctx;
<a name="l00514"></a>00514 
<a name="l00515"></a>00515   ctx = g_malloc0 (<span class="keyword">sizeof</span> *ctx);
<a name="l00516"></a>00516   ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a6fa3a20ae883858a43ff96aae90fd2d6">encctx</a> = openvas_init_gpgme_ctx ();
<a name="l00517"></a>00517   <span class="keywordflow">if</span> (!ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a6fa3a20ae883858a43ff96aae90fd2d6">encctx</a>)
<a name="l00518"></a>00518     {
<a name="l00519"></a>00519       g_critical (<span class="stringliteral">&quot;%s: can&apos;t continue w/o a gpgme context\n&quot;</span>, G_STRFUNC);
<a name="l00520"></a>00520       exit (EXIT_FAILURE);
<a name="l00521"></a>00521     }
<a name="l00522"></a>00522 
<a name="l00523"></a>00523   <span class="keywordflow">return</span> ctx;
<a name="l00524"></a>00524 }
</pre></div></p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<a class="anchor" id="aa383411c640ff7e7bfcac95ea1fba084"></a><!-- doxytag: member="lsc_crypt.h::lsc_crypt_release" ref="aa383411c640ff7e7bfcac95ea1fba084" args="(lsc_crypt_ctx_t)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void lsc_crypt_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structlsc__crypt__ctx__s.html">lsc_crypt_ctx_t</a>&nbsp;</td>
          <td class="paramname"> <em>ctx</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Release an LSC encryption context. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>ctx</em>&nbsp;</td><td>The context or NULL </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lsc__crypt_8c_source.html#l00532">532</a> of file <a class="el" href="lsc__crypt_8c_source.html">lsc_crypt.c</a>.</p>

<p>References <a class="el" href="lsc__crypt_8c_source.html#l00093">lsc_crypt_ctx_s::encctx</a>, and <a class="el" href="lsc__crypt_8c_source.html#l00590">lsc_crypt_flush()</a>.</p>

<p>Referenced by <a class="el" href="sql_8c_source.html#l02228">cleanup_iterator()</a>, <a class="el" href="manage__sql_8c_source.html#l33148">create_lsc_credential()</a>, <a class="el" href="lsc__crypt_8c_source.html#l00553">lsc_crypt_create_key()</a>, and <a class="el" href="manage__sql_8c_source.html#l33834">set_lsc_credential_password()</a>.</p>

<p><div class="fragment"><pre class="fragment"><a name="l00533"></a>00533 {
<a name="l00534"></a>00534   <span class="keywordflow">if</span> (!ctx)
<a name="l00535"></a>00535     <span class="keywordflow">return</span>;
<a name="l00536"></a>00536   <a class="code" href="lsc__crypt_8c.html#a87f56fad71eec65ff82baf9df5084baf" title="Flush an LSC encryption context.">lsc_crypt_flush</a> (ctx);
<a name="l00537"></a>00537   <span class="keywordflow">if</span> (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a6fa3a20ae883858a43ff96aae90fd2d6">encctx</a>) <span class="comment">/* Check required for gpgme &lt; 1.3.1 */</span>
<a name="l00538"></a>00538     gpgme_release (ctx-&gt;<a class="code" href="structlsc__crypt__ctx__s.html#a6fa3a20ae883858a43ff96aae90fd2d6">encctx</a>);
<a name="l00539"></a>00539   g_free (ctx);
<a name="l00540"></a>00540 }
</pre></div></p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="a273eb151f932f83e1f641f52e9c1b60c"></a><!-- doxytag: member="lsc_crypt.h::disable_encrypted_credentials" ref="a273eb151f932f83e1f641f52e9c1b60c" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="openvasmd_8c.html#a2d5b213281ee7d9db5069752ecde01e3">disable_encrypted_credentials</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Flag indicating that encrypted credentials are disabled. </p>
<p>Setting this flag does not change any existing encrypted tuples but simply won't encrypt or decrypt anything. The variable is controlled by the command line option --disable-encrypted-credentials. </p>

<p>Definition at line <a class="el" href="openvasmd_8c_source.html#l00280">280</a> of file <a class="el" href="openvasmd_8c_source.html">openvasmd.c</a>.</p>

<p>Referenced by <a class="el" href="manage__sql_8c_source.html#l33148">create_lsc_credential()</a>, <a class="el" href="openvasmd_8c_source.html#l01269">main()</a>, and <a class="el" href="manage__sql_8c_source.html#l33834">set_lsc_credential_password()</a>.</p>

</div>
</div>
</div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 23 Oct 2015 for OpenVAS Manager by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
